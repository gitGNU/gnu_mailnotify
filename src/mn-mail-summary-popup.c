/* Generated by GOB (v2.0.12) on Tue Aug  9 22:01:57 2005
   (do not edit directly) */

/* End world hunger, donate to the World Food Programme, http://www.wfp.org */

#define GOB_VERSION_MAJOR 2
#define GOB_VERSION_MINOR 0
#define GOB_VERSION_PATCHLEVEL 12

#define selfp (self->_priv)

#include <string.h> /* memset() */

#include "mn-mail-summary-popup.h"

#include "mn-mail-summary-popup-private.h"

#ifdef G_LIKELY
#define ___GOB_LIKELY(expr) G_LIKELY(expr)
#define ___GOB_UNLIKELY(expr) G_UNLIKELY(expr)
#else /* ! G_LIKELY */
#define ___GOB_LIKELY(expr) (expr)
#define ___GOB_UNLIKELY(expr) (expr)
#endif /* G_LIKELY */

#line 29 "mn-mail-summary-popup.gob"

#include "config.h"
#include <glib/gi18n.h>
#include <eel/eel.h>
#include "mn-util.h"
#include "mn-conf.h"
#include "mn-stock.h"
#include "mn-message-view.h"

#line 37 "mn-mail-summary-popup.c"
/* self casting macros */
#define SELF(x) MN_MAIL_SUMMARY_POPUP(x)
#define SELF_CONST(x) MN_MAIL_SUMMARY_POPUP_CONST(x)
#define IS_SELF(x) MN_IS_MAIL_SUMMARY_POPUP(x)
#define TYPE_SELF MN_TYPE_MAIL_SUMMARY_POPUP
#define SELF_CLASS(x) MN_MAIL_SUMMARY_POPUP_CLASS(x)

#define SELF_GET_CLASS(x) MN_MAIL_SUMMARY_POPUP_GET_CLASS(x)

/* self typedefs */
typedef MNMailSummaryPopup Self;
typedef MNMailSummaryPopupClass SelfClass;

/* here are local prototypes */
static void mn_mail_summary_popup_class_init (MNMailSummaryPopupClass * c) G_GNUC_UNUSED;
static void mn_mail_summary_popup_init (MNMailSummaryPopup * self) G_GNUC_UNUSED;
static void ___2_mn_mail_summary_popup_finalize (GObject * object) G_GNUC_UNUSED;
static void mn_mail_summary_popup_realize_set_decorations_h (MNMailSummaryPopup * self, gpointer user_data) G_GNUC_UNUSED;
static void mn_mail_summary_popup_realize_set_geometry_h (MNMailSummaryPopup * self, gpointer user_data) G_GNUC_UNUSED;
static void mn_mail_summary_popup_notify_autoclose_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data) G_GNUC_UNUSED;
static void mn_mail_summary_popup_notify_delay_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data) G_GNUC_UNUSED;
static void mn_mail_summary_popup_notify_geometry_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data) G_GNUC_UNUSED;
static void mn_mail_summary_popup_notify_fonts_aspect_source_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data) G_GNUC_UNUSED;
static void mn_mail_summary_popup_notify_fonts_title_font_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data) G_GNUC_UNUSED;
static void mn_mail_summary_popup_notify_fonts_contents_font_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data) G_GNUC_UNUSED;
static void mn_mail_summary_popup_install_timeout (MNMailSummaryPopup * self) G_GNUC_UNUSED;
static gboolean mn_mail_summary_popup_timeout_cb (MNMailSummaryPopup * self) G_GNUC_UNUSED;
static void mn_mail_summary_popup_set_geometry (MNMailSummaryPopup * self) G_GNUC_UNUSED;
static void mn_mail_summary_popup_set_title_font (MNMailSummaryPopup * self) G_GNUC_UNUSED;
static void mn_mail_summary_popup_set_contents_font (MNMailSummaryPopup * self) G_GNUC_UNUSED;
static void mn_mail_summary_popup_set_font (MNMailSummaryPopup * self, GtkWidget * widget, const char * conf_key) G_GNUC_UNUSED;

/* pointer to the class of our parent */
static GtkWindowClass *parent_class = NULL;

/* Short form macros */
#define self_realize_set_decorations_h mn_mail_summary_popup_realize_set_decorations_h
#define self_realize_set_geometry_h mn_mail_summary_popup_realize_set_geometry_h
#define self_notify_autoclose_cb mn_mail_summary_popup_notify_autoclose_cb
#define self_notify_delay_cb mn_mail_summary_popup_notify_delay_cb
#define self_notify_geometry_cb mn_mail_summary_popup_notify_geometry_cb
#define self_notify_fonts_aspect_source_cb mn_mail_summary_popup_notify_fonts_aspect_source_cb
#define self_notify_fonts_title_font_cb mn_mail_summary_popup_notify_fonts_title_font_cb
#define self_notify_fonts_contents_font_cb mn_mail_summary_popup_notify_fonts_contents_font_cb
#define self_install_timeout mn_mail_summary_popup_install_timeout
#define self_timeout_cb mn_mail_summary_popup_timeout_cb
#define self_set_geometry mn_mail_summary_popup_set_geometry
#define self_set_title_font mn_mail_summary_popup_set_title_font
#define self_set_contents_font mn_mail_summary_popup_set_contents_font
#define self_set_font mn_mail_summary_popup_set_font
#define self_set_messages mn_mail_summary_popup_set_messages
#define self_reset_timeout mn_mail_summary_popup_reset_timeout
#define self_new mn_mail_summary_popup_new
#define self_button_press_event_h mn_mail_summary_popup_button_press_event_h
#define self_message_view_new_cb mn_mail_summary_popup_message_view_new_cb
GType
mn_mail_summary_popup_get_type (void)
{
	static GType type = 0;

	if ___GOB_UNLIKELY(type == 0) {
		static const GTypeInfo info = {
			sizeof (MNMailSummaryPopupClass),
			(GBaseInitFunc) NULL,
			(GBaseFinalizeFunc) NULL,
			(GClassInitFunc) mn_mail_summary_popup_class_init,
			(GClassFinalizeFunc) NULL,
			NULL /* class_data */,
			sizeof (MNMailSummaryPopup),
			0 /* n_preallocs */,
			(GInstanceInitFunc) mn_mail_summary_popup_init,
			NULL
		};

		type = g_type_register_static (GTK_TYPE_WINDOW, "MNMailSummaryPopup", &info, (GTypeFlags)0);
	}

	return type;
}

/* a macro for creating a new object of our type */
#define GET_NEW ((MNMailSummaryPopup *)g_object_new(mn_mail_summary_popup_get_type(), NULL))

/* a function for creating a new object of our type */
#include <stdarg.h>
static MNMailSummaryPopup * GET_NEW_VARG (const char *first, ...) G_GNUC_UNUSED;
static MNMailSummaryPopup *
GET_NEW_VARG (const char *first, ...)
{
	MNMailSummaryPopup *ret;
	va_list ap;
	va_start (ap, first);
	ret = (MNMailSummaryPopup *)g_object_new_valist (mn_mail_summary_popup_get_type (), first, ap);
	va_end (ap);
	return ret;
}


static void
___finalize(GObject *obj_self)
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::finalize"
	MNMailSummaryPopup *self G_GNUC_UNUSED = MN_MAIL_SUMMARY_POPUP (obj_self);
	gpointer priv G_GNUC_UNUSED = self->_priv;
#line 116 "mn-mail-summary-popup.gob"
	___2_mn_mail_summary_popup_finalize(obj_self);
#line 144 "mn-mail-summary-popup.c"
}
#undef __GOB_FUNCTION__

static void 
mn_mail_summary_popup_class_init (MNMailSummaryPopupClass * c G_GNUC_UNUSED)
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::class_init"
	GObjectClass *g_object_class G_GNUC_UNUSED = (GObjectClass*) c;

	g_type_class_add_private(c,sizeof(MNMailSummaryPopupPrivate));

	parent_class = g_type_class_ref (GTK_TYPE_WINDOW);

#line 116 "mn-mail-summary-popup.gob"
	g_object_class->finalize = ___finalize;
#line 160 "mn-mail-summary-popup.c"
}
#undef __GOB_FUNCTION__
#line 49 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_init (MNMailSummaryPopup * self G_GNUC_UNUSED)
#line 166 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::init"
	self->_priv = G_TYPE_INSTANCE_GET_PRIVATE(self,MN_TYPE_MAIL_SUMMARY_POPUP,MNMailSummaryPopupPrivate);
#line 29 "mn-mail-summary-popup.gob"
	self->_priv->gravity = -1;
#line 172 "mn-mail-summary-popup.c"
 {
#line 50 "mn-mail-summary-popup.gob"

    mn_container_create_interface(GTK_CONTAINER(self),
				  MN_INTERFACE_FILE("mail-summary-popup.glade"),
				  "eventbox",
				  "mn_mail_summary_popup_",
				  "image", &selfp->image,
				  "mn-mail-summary-popup-title", &selfp->title,
				  "mn-message-view", &selfp->message_view,
				  NULL);

    gtk_widget_set_name(GTK_WIDGET(self), "mn-mail-summary-popup");

    /*
     * The popup must:
     *
     *	- be sticky
     *	- be kept above other windows
     *	- not be focusable
     *	- not be decorated
     *	- not appear in the pager
     *	- not appear in the taskbar
     *
     * An easy way to meet these requirements is to use a window of
     * type GTK_WINDOW_POPUP, but unfortunately these are not hidden
     * by xscreensaver
     * (http://bugzilla.gnome.org/show_bug.cgi?id=154529).
     *
     * We therefore use a window of type GTK_WINDOW_TOPLEVEL along
     * with appropriate properties (but a drawback is
     * http://bugzilla.gnome.org/show_bug.cgi?id=154593).
     */
    
    gtk_window_set_title(GTK_WINDOW(self), "");
    gtk_window_set_resizable(GTK_WINDOW(self), FALSE);
    gtk_window_set_keep_above(GTK_WINDOW(self), TRUE);
    gtk_window_set_decorated(GTK_WINDOW(self), FALSE);
    gtk_window_set_skip_taskbar_hint(GTK_WINDOW(self), TRUE);
    gtk_window_set_skip_pager_hint(GTK_WINDOW(self), TRUE);
    gtk_window_set_accept_focus(GTK_WINDOW(self), FALSE);
    gtk_window_set_focus_on_map(GTK_WINDOW(self), FALSE);
    gtk_window_stick(GTK_WINDOW(self));

    gtk_image_set_from_stock(GTK_IMAGE(selfp->image), MN_STOCK_MAIL_SUMMARY, -1);

    self_set_title_font(self);
    self_set_contents_font(self);

    if (eel_gconf_get_boolean(MN_CONF_MAIL_SUMMARY_POPUP_AUTOCLOSE))
      self_install_timeout(self);

    mn_conf_notifications_add(self,
			      MN_CONF_MAIL_SUMMARY_POPUP_AUTOCLOSE, self_notify_autoclose_cb, self,
			      MN_CONF_MAIL_SUMMARY_POPUP_AUTOCLOSE_DELAY_NAMESPACE, self_notify_delay_cb, self,
			      MN_CONF_MAIL_SUMMARY_POPUP_POSITION, self_notify_geometry_cb, self,
			      MN_CONF_MAIL_SUMMARY_POPUP_OFFSET_NAMESPACE, self_notify_geometry_cb, self,
			      MN_CONF_MAIL_SUMMARY_POPUP_FONTS_ASPECT_SOURCE, self_notify_fonts_aspect_source_cb, self,
			      MN_CONF_MAIL_SUMMARY_POPUP_FONTS_TITLE_FONT, self_notify_fonts_title_font_cb, self,
			      MN_CONF_MAIL_SUMMARY_POPUP_FONTS_CONTENTS_FONT, self_notify_fonts_contents_font_cb, self,
			      NULL);

    g_object_connect(self,
		     "signal::realize", self_realize_set_decorations_h, NULL,
		     "signal::realize", self_realize_set_geometry_h, NULL,
		     NULL);
  
#line 240 "mn-mail-summary-popup.c"
 }
}
#undef __GOB_FUNCTION__



#line 116 "mn-mail-summary-popup.gob"
static void 
___2_mn_mail_summary_popup_finalize (GObject * object G_GNUC_UNUSED)
#line 250 "mn-mail-summary-popup.c"
#define PARENT_HANDLER(___object) \
	{ if(G_OBJECT_CLASS(parent_class)->finalize) \
		(* G_OBJECT_CLASS(parent_class)->finalize)(___object); }
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::finalize"
{
#line 118 "mn-mail-summary-popup.gob"
	
    Self *self = SELF(object);

    if (selfp->timeout_id)
      g_source_remove(selfp->timeout_id);

    PARENT_HANDLER(object);
  }}
#line 266 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__
#undef PARENT_HANDLER

#line 127 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_realize_set_decorations_h (MNMailSummaryPopup * self, gpointer user_data)
#line 273 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::realize_set_decorations_h"
#line 127 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 127 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 280 "mn-mail-summary-popup.c"
{
#line 129 "mn-mail-summary-popup.gob"
	
    /*
     * gdk_window_set_decorations() needs the widget's GdkWindow, this
     * is why we must call it after the widget is realized.
     */
    gdk_window_set_decorations(GTK_WIDGET(self)->window, GDK_DECOR_BORDER);
  }}
#line 290 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 137 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_realize_set_geometry_h (MNMailSummaryPopup * self, gpointer user_data)
#line 296 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::realize_set_geometry_h"
#line 137 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 137 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 303 "mn-mail-summary-popup.c"
{
#line 139 "mn-mail-summary-popup.gob"
	
    /* one shot */
    g_signal_handlers_disconnect_by_func(self, self_realize_set_geometry_h, NULL);
    self_set_geometry(self);
  }}
#line 311 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 145 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_notify_autoclose_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data)
#line 317 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::notify_autoclose_cb"
{
#line 150 "mn-mail-summary-popup.gob"
	
    Self *self = user_data;

    GDK_THREADS_ENTER();

    if (eel_gconf_get_boolean(MN_CONF_MAIL_SUMMARY_POPUP_AUTOCLOSE))
      {
	if (! selfp->timeout_id)
	  self_install_timeout(self);
      }
    else
      mn_source_clear(&selfp->timeout_id);
    
    GDK_THREADS_LEAVE();
  }}
#line 337 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 166 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_notify_delay_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data)
#line 343 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::notify_delay_cb"
{
#line 171 "mn-mail-summary-popup.gob"
	
    Self *self = user_data;

    GDK_THREADS_ENTER();

    self_reset_timeout(self);
    
    GDK_THREADS_LEAVE();
  }}
#line 357 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 181 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_notify_geometry_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data)
#line 363 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::notify_geometry_cb"
{
#line 186 "mn-mail-summary-popup.gob"
	
    Self *self = user_data;

    GDK_THREADS_ENTER();

    self_set_geometry(self);

    GDK_THREADS_LEAVE();
  }}
#line 377 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 196 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_notify_fonts_aspect_source_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data)
#line 383 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::notify_fonts_aspect_source_cb"
{
#line 201 "mn-mail-summary-popup.gob"
	
    Self *self = user_data;

    GDK_THREADS_ENTER();

    self_set_title_font(self);
    self_set_contents_font(self);

    GDK_THREADS_LEAVE();
  }}
#line 398 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 212 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_notify_fonts_title_font_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data)
#line 404 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::notify_fonts_title_font_cb"
{
#line 217 "mn-mail-summary-popup.gob"
	
    Self *self = user_data;

    GDK_THREADS_ENTER();

    self_set_title_font(self);

    GDK_THREADS_LEAVE();
  }}
#line 418 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 227 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_notify_fonts_contents_font_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data)
#line 424 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::notify_fonts_contents_font_cb"
{
#line 232 "mn-mail-summary-popup.gob"
	
    Self *self = user_data;

    GDK_THREADS_ENTER();

    self_set_contents_font(self);

    GDK_THREADS_LEAVE();
  }}
#line 438 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 242 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_install_timeout (MNMailSummaryPopup * self)
#line 444 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::install_timeout"
#line 242 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 242 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 451 "mn-mail-summary-popup.c"
{
#line 244 "mn-mail-summary-popup.gob"
	
    g_return_if_fail(selfp->timeout_id == 0);

    selfp->timeout_id = mn_timeout_add(MN_CONF_MAIL_SUMMARY_POPUP_AUTOCLOSE_DELAY_MINUTES,
				       MN_CONF_MAIL_SUMMARY_POPUP_AUTOCLOSE_DELAY_SECONDS,
				       (GSourceFunc) self_timeout_cb,
				       self);
  }}
#line 462 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 253 "mn-mail-summary-popup.gob"
static gboolean 
mn_mail_summary_popup_timeout_cb (MNMailSummaryPopup * self)
#line 468 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::timeout_cb"
#line 253 "mn-mail-summary-popup.gob"
	g_return_val_if_fail (self != NULL, (gboolean )0);
#line 253 "mn-mail-summary-popup.gob"
	g_return_val_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self), (gboolean )0);
#line 475 "mn-mail-summary-popup.c"
{
#line 255 "mn-mail-summary-popup.gob"
	
    GDK_THREADS_ENTER();
    gtk_widget_destroy(GTK_WIDGET(self));
    GDK_THREADS_LEAVE();
  
    return FALSE;		/* remove timeout */
  }}
#line 485 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 263 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_set_geometry (MNMailSummaryPopup * self)
#line 491 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::set_geometry"
#line 263 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 263 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 498 "mn-mail-summary-popup.c"
{
#line 265 "mn-mail-summary-popup.gob"
	
    MNPosition position;
    int horizontal_offset;
    int vertical_offset;
    int popup_width;
    int popup_height;
    int screen_width;
    int screen_height;
    GdkGravity gravity_mapping[] = {
      GDK_GRAVITY_NORTH_WEST,
      GDK_GRAVITY_NORTH_EAST,
      GDK_GRAVITY_SOUTH_WEST,
      GDK_GRAVITY_SOUTH_EAST
    };
    GdkGravity gravity;
    int x;
    int y;
    gboolean reshow = FALSE;

    position = mn_conf_get_enum_value(MN_TYPE_POSITION, MN_CONF_MAIL_SUMMARY_POPUP_POSITION);
    horizontal_offset = eel_gconf_get_integer(MN_CONF_MAIL_SUMMARY_POPUP_HORIZONTAL_OFFSET);
    vertical_offset = eel_gconf_get_integer(MN_CONF_MAIL_SUMMARY_POPUP_VERTICAL_OFFSET);

    gtk_window_get_size(GTK_WINDOW(self), &popup_width, &popup_height);
    screen_width = gdk_screen_width();
    screen_height = gdk_screen_height();

    g_return_if_fail(position >= 0 && position < G_N_ELEMENTS(gravity_mapping));
    gravity = gravity_mapping[position];

    x = (gravity == GDK_GRAVITY_NORTH_WEST || gravity == GDK_GRAVITY_SOUTH_WEST)
      ? horizontal_offset
      : screen_width - popup_width - horizontal_offset;
    y = (gravity == GDK_GRAVITY_NORTH_WEST || gravity == GDK_GRAVITY_NORTH_EAST)
      ? vertical_offset
      : screen_height - popup_height - vertical_offset;

    /*
     * If the gravity changes, the gtk_window_move() call will misplace
     * the window (probably a Metacity bug).
     *
     * A workaround is to reshow the window.
     */
    if (gravity != selfp->gravity)
      {
	if (selfp->gravity != -1)
	  reshow = TRUE;

	selfp->gravity = gravity;
      }

    if (reshow)
      {
	gtk_widget_hide(GTK_WIDGET(self));

	/*
	 * If we do not unrealize the window, it will appear in the
	 * task bar the next time we show it.
	 */
	gtk_widget_unrealize(GTK_WIDGET(self));
      }

    gtk_window_set_gravity(GTK_WINDOW(self), gravity);
    gtk_window_move(GTK_WINDOW(self), x, y);

    if (reshow)
      gtk_widget_show(GTK_WIDGET(self));
  }}
#line 569 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 334 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_set_title_font (MNMailSummaryPopup * self)
#line 575 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::set_title_font"
#line 334 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 334 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 582 "mn-mail-summary-popup.c"
{
#line 336 "mn-mail-summary-popup.gob"
	
    self_set_font(self, selfp->title, MN_CONF_MAIL_SUMMARY_POPUP_FONTS_TITLE_FONT);
  }}
#line 588 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 340 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_set_contents_font (MNMailSummaryPopup * self)
#line 594 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::set_contents_font"
#line 340 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 340 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 601 "mn-mail-summary-popup.c"
{
#line 342 "mn-mail-summary-popup.gob"
	
    self_set_font(self, selfp->message_view, MN_CONF_MAIL_SUMMARY_POPUP_FONTS_CONTENTS_FONT);
  }}
#line 607 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 346 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_set_font (MNMailSummaryPopup * self, GtkWidget * widget, const char * conf_key)
#line 613 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::set_font"
#line 346 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 346 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 346 "mn-mail-summary-popup.gob"
	g_return_if_fail (widget != NULL);
#line 346 "mn-mail-summary-popup.gob"
	g_return_if_fail (GTK_IS_WIDGET (widget));
#line 346 "mn-mail-summary-popup.gob"
	g_return_if_fail (conf_key != NULL);
#line 626 "mn-mail-summary-popup.c"
{
#line 350 "mn-mail-summary-popup.gob"
	
    PangoFontDescription *font_desc = NULL;

    if (mn_conf_get_enum_value(MN_TYPE_ASPECT_SOURCE, MN_CONF_MAIL_SUMMARY_POPUP_FONTS_ASPECT_SOURCE) == MN_ASPECT_SOURCE_CUSTOM)
      {
	char *str;
	
	str = eel_gconf_get_string(conf_key);
	if (str)
	  {
	    font_desc = pango_font_description_from_string(str);
	    g_free(str);
	  }
      }
    
    gtk_widget_modify_font(widget, font_desc);
    if (font_desc)
      pango_font_description_free(font_desc);
  }}
#line 648 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 370 "mn-mail-summary-popup.gob"
void 
mn_mail_summary_popup_set_messages (MNMailSummaryPopup * self, GSList * messages)
#line 654 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::set_messages"
#line 370 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 370 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 370 "mn-mail-summary-popup.gob"
	g_return_if_fail (messages != NULL);
#line 663 "mn-mail-summary-popup.c"
{
#line 372 "mn-mail-summary-popup.gob"
	
    mn_message_view_set_messages(MN_MESSAGE_VIEW(selfp->message_view), messages);
  }}
#line 669 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 376 "mn-mail-summary-popup.gob"
void 
mn_mail_summary_popup_reset_timeout (MNMailSummaryPopup * self)
#line 675 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::reset_timeout"
#line 376 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 376 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 682 "mn-mail-summary-popup.c"
{
#line 378 "mn-mail-summary-popup.gob"
	
    if (eel_gconf_get_boolean(MN_CONF_MAIL_SUMMARY_POPUP_AUTOCLOSE))
      {
	mn_source_clear(&selfp->timeout_id);
	self_install_timeout(self);
      }
  }}
#line 692 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 386 "mn-mail-summary-popup.gob"
GtkWidget * 
mn_mail_summary_popup_new (void)
#line 698 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::new"
{
#line 388 "mn-mail-summary-popup.gob"
	
    return GTK_WIDGET(GET_NEW);
  }}
#line 706 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 394 "mn-mail-summary-popup.gob"
gboolean 
mn_mail_summary_popup_button_press_event_h (MNMailSummaryPopup * self, GdkEventButton * button, GtkWidget * widget)
#line 712 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::button_press_event_h"
#line 394 "mn-mail-summary-popup.gob"
	g_return_val_if_fail (self != NULL, (gboolean )0);
#line 394 "mn-mail-summary-popup.gob"
	g_return_val_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self), (gboolean )0);
#line 719 "mn-mail-summary-popup.c"
{
#line 396 "mn-mail-summary-popup.gob"
	
    gtk_widget_destroy(GTK_WIDGET(self));

    return TRUE;		/* do not propagate event */
  }}
#line 727 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 402 "mn-mail-summary-popup.gob"
GtkWidget * 
mn_mail_summary_popup_message_view_new_cb (void)
#line 733 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::message_view_new_cb"
{
#line 404 "mn-mail-summary-popup.gob"
	
    GtkWidget *view;

    view = mn_message_view_new(TRUE, FALSE);
    gtk_widget_show(view);

    return view;
  }}
#line 746 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__
