/* Generated by GOB (v2.0.14)   (do not edit directly) */

/* End world hunger, donate to the World Food Programme, http://www.wfp.org */

#define GOB_VERSION_MAJOR 2
#define GOB_VERSION_MINOR 0
#define GOB_VERSION_PATCHLEVEL 14

#define selfp (self->_priv)

#include <string.h> /* memset() */

#include "mn-mail-summary-popup.h"

#include "mn-mail-summary-popup-private.h"

#ifdef G_LIKELY
#define ___GOB_LIKELY(expr) G_LIKELY(expr)
#define ___GOB_UNLIKELY(expr) G_UNLIKELY(expr)
#else /* ! G_LIKELY */
#define ___GOB_LIKELY(expr) (expr)
#define ___GOB_UNLIKELY(expr) (expr)
#endif /* G_LIKELY */

#line 30 "mn-mail-summary-popup.gob"

#include "config.h"
#include <glib/gi18n.h>
#include <eel/eel.h>
#include "mn-conf.h"
#include "mn-stock.h"
#include "mn-standard-message-view.h"
#include "mn-compact-message-view.h"

#line 36 "mn-mail-summary-popup.c"
static const GEnumValue _mn_mail_summary_popup_layout_values[] = {
	{ MN_MAIL_SUMMARY_POPUP_LAYOUT_STANDARD, (char *)"MN_MAIL_SUMMARY_POPUP_LAYOUT_STANDARD", (char *)"standard" },
	{ MN_MAIL_SUMMARY_POPUP_LAYOUT_COMPACT, (char *)"MN_MAIL_SUMMARY_POPUP_LAYOUT_COMPACT", (char *)"compact" },
	{ 0, NULL, NULL }
};

GType
mn_mail_summary_popup_layout_get_type (void)
{
	static GType type = 0;
	if ___GOB_UNLIKELY(type == 0)
		type = g_enum_register_static ("MNMailSummaryPopupLayout", _mn_mail_summary_popup_layout_values);
	return type;
}

/* self casting macros */
#define SELF(x) MN_MAIL_SUMMARY_POPUP(x)
#define SELF_CONST(x) MN_MAIL_SUMMARY_POPUP_CONST(x)
#define IS_SELF(x) MN_IS_MAIL_SUMMARY_POPUP(x)
#define TYPE_SELF MN_TYPE_MAIL_SUMMARY_POPUP
#define SELF_CLASS(x) MN_MAIL_SUMMARY_POPUP_CLASS(x)

#define SELF_GET_CLASS(x) MN_MAIL_SUMMARY_POPUP_GET_CLASS(x)

/* self typedefs */
typedef MNMailSummaryPopup Self;
typedef MNMailSummaryPopupClass SelfClass;

/* here are local prototypes */
static void mn_mail_summary_popup_class_init (MNMailSummaryPopupClass * c) G_GNUC_UNUSED;
static void mn_mail_summary_popup_init (MNMailSummaryPopup * self) G_GNUC_UNUSED;
static void ___2_mn_mail_summary_popup_finalize (GObject * object) G_GNUC_UNUSED;
static void mn_mail_summary_popup_realize_set_decorations_h (MNMailSummaryPopup * self, gpointer user_data) G_GNUC_UNUSED;
static void mn_mail_summary_popup_realize_set_geometry_h (MNMailSummaryPopup * self, gpointer user_data) G_GNUC_UNUSED;
static void mn_mail_summary_popup_notify_autoclose_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data) G_GNUC_UNUSED;
static void mn_mail_summary_popup_notify_delay_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data) G_GNUC_UNUSED;
static void mn_mail_summary_popup_notify_layout_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data) G_GNUC_UNUSED;
static void mn_mail_summary_popup_notify_geometry_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data) G_GNUC_UNUSED;
static void mn_mail_summary_popup_notify_fonts_aspect_source_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data) G_GNUC_UNUSED;
static void mn_mail_summary_popup_notify_fonts_title_font_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data) G_GNUC_UNUSED;
static void mn_mail_summary_popup_notify_fonts_contents_font_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data) G_GNUC_UNUSED;
static void mn_mail_summary_popup_install_timeout (MNMailSummaryPopup * self) G_GNUC_UNUSED;
static gboolean mn_mail_summary_popup_timeout_cb (gpointer data) G_GNUC_UNUSED;
static void mn_mail_summary_popup_set_layout (MNMailSummaryPopup * self) G_GNUC_UNUSED;
static void mn_mail_summary_popup_set_geometry (MNMailSummaryPopup * self) G_GNUC_UNUSED;
static void mn_mail_summary_popup_set_title_font (MNMailSummaryPopup * self) G_GNUC_UNUSED;
static void mn_mail_summary_popup_set_contents_font (MNMailSummaryPopup * self) G_GNUC_UNUSED;
static void mn_mail_summary_popup_set_font (MNMailSummaryPopup * self, GtkWidget * widget, const char * conf_key) G_GNUC_UNUSED;

/* pointer to the class of our parent */
static GtkWindowClass *parent_class = NULL;

/* Short form macros */
#define self_realize_set_decorations_h mn_mail_summary_popup_realize_set_decorations_h
#define self_realize_set_geometry_h mn_mail_summary_popup_realize_set_geometry_h
#define self_notify_autoclose_cb mn_mail_summary_popup_notify_autoclose_cb
#define self_notify_delay_cb mn_mail_summary_popup_notify_delay_cb
#define self_notify_layout_cb mn_mail_summary_popup_notify_layout_cb
#define self_notify_geometry_cb mn_mail_summary_popup_notify_geometry_cb
#define self_notify_fonts_aspect_source_cb mn_mail_summary_popup_notify_fonts_aspect_source_cb
#define self_notify_fonts_title_font_cb mn_mail_summary_popup_notify_fonts_title_font_cb
#define self_notify_fonts_contents_font_cb mn_mail_summary_popup_notify_fonts_contents_font_cb
#define self_install_timeout mn_mail_summary_popup_install_timeout
#define self_timeout_cb mn_mail_summary_popup_timeout_cb
#define self_set_layout mn_mail_summary_popup_set_layout
#define self_set_geometry mn_mail_summary_popup_set_geometry
#define self_set_title_font mn_mail_summary_popup_set_title_font
#define self_set_contents_font mn_mail_summary_popup_set_contents_font
#define self_set_font mn_mail_summary_popup_set_font
#define self_set_messages mn_mail_summary_popup_set_messages
#define self_reset_timeout mn_mail_summary_popup_reset_timeout
#define self_new mn_mail_summary_popup_new
#define self_button_press_event_h mn_mail_summary_popup_button_press_event_h
GType
mn_mail_summary_popup_get_type (void)
{
	static GType type = 0;

	if ___GOB_UNLIKELY(type == 0) {
		static const GTypeInfo info = {
			sizeof (MNMailSummaryPopupClass),
			(GBaseInitFunc) NULL,
			(GBaseFinalizeFunc) NULL,
			(GClassInitFunc) mn_mail_summary_popup_class_init,
			(GClassFinalizeFunc) NULL,
			NULL /* class_data */,
			sizeof (MNMailSummaryPopup),
			0 /* n_preallocs */,
			(GInstanceInitFunc) mn_mail_summary_popup_init,
			NULL
		};

		type = g_type_register_static (GTK_TYPE_WINDOW, "MNMailSummaryPopup", &info, (GTypeFlags)0);
	}

	return type;
}

/* a macro for creating a new object of our type */
#define GET_NEW ((MNMailSummaryPopup *)g_object_new(mn_mail_summary_popup_get_type(), NULL))

/* a function for creating a new object of our type */
#include <stdarg.h>
static MNMailSummaryPopup * GET_NEW_VARG (const char *first, ...) G_GNUC_UNUSED;
static MNMailSummaryPopup *
GET_NEW_VARG (const char *first, ...)
{
	MNMailSummaryPopup *ret;
	va_list ap;
	va_start (ap, first);
	ret = (MNMailSummaryPopup *)g_object_new_valist (mn_mail_summary_popup_get_type (), first, ap);
	va_end (ap);
	return ret;
}


static void
___finalize(GObject *obj_self)
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::finalize"
	MNMailSummaryPopup *self G_GNUC_UNUSED = MN_MAIL_SUMMARY_POPUP (obj_self);
	gpointer priv G_GNUC_UNUSED = self->_priv;
#line 125 "mn-mail-summary-popup.gob"
	___2_mn_mail_summary_popup_finalize(obj_self);
#line 161 "mn-mail-summary-popup.c"
#line 57 "mn-mail-summary-popup.gob"
	if(self->_priv->messages) { mn_g_object_slist_free ((gpointer) self->_priv->messages); self->_priv->messages = NULL; }
#line 164 "mn-mail-summary-popup.c"
}
#undef __GOB_FUNCTION__

static void 
mn_mail_summary_popup_class_init (MNMailSummaryPopupClass * c G_GNUC_UNUSED)
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::class_init"
	GObjectClass *g_object_class G_GNUC_UNUSED = (GObjectClass*) c;

	g_type_class_add_private(c,sizeof(MNMailSummaryPopupPrivate));

	parent_class = g_type_class_ref (GTK_TYPE_WINDOW);

#line 125 "mn-mail-summary-popup.gob"
	g_object_class->finalize = ___finalize;
#line 180 "mn-mail-summary-popup.c"
}
#undef __GOB_FUNCTION__
#line 59 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_init (MNMailSummaryPopup * self G_GNUC_UNUSED)
#line 186 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::init"
	self->_priv = G_TYPE_INSTANCE_GET_PRIVATE(self,MN_TYPE_MAIL_SUMMARY_POPUP,MNMailSummaryPopupPrivate);
#line 30 "mn-mail-summary-popup.gob"
	self->_priv->gravity = -1;
#line 192 "mn-mail-summary-popup.c"
 {
#line 60 "mn-mail-summary-popup.gob"

    mn_container_create_interface(GTK_CONTAINER(self),
				  UIDIR G_DIR_SEPARATOR_S "mail-summary-popup.glade",
				  "eventbox",
				  "mn_mail_summary_popup_",
				  "image", &selfp->image,
				  "mn-mail-summary-popup-title", &selfp->title,
				  "vbox", &selfp->vbox,
				  NULL);

    gtk_widget_set_name(GTK_WIDGET(self), "mn-mail-summary-popup");

    /*
     * The popup must:
     *
     *	- be sticky
     *	- be kept above other windows
     *	- not be focusable
     *	- not be decorated
     *	- not appear in the pager
     *	- not appear in the taskbar
     *
     * An easy way to meet these requirements is to use a window of
     * type GTK_WINDOW_POPUP, but unfortunately these are not hidden
     * by xscreensaver
     * (http://bugzilla.gnome.org/show_bug.cgi?id=154529).
     *
     * We therefore use a window of type GTK_WINDOW_TOPLEVEL along
     * with appropriate properties (but a drawback is
     * http://bugzilla.gnome.org/show_bug.cgi?id=154593).
     */

    gtk_window_set_title(GTK_WINDOW(self), "");
    gtk_window_set_resizable(GTK_WINDOW(self), FALSE);
    gtk_window_set_keep_above(GTK_WINDOW(self), TRUE);
    gtk_window_set_decorated(GTK_WINDOW(self), FALSE);
    gtk_window_set_skip_taskbar_hint(GTK_WINDOW(self), TRUE);
    gtk_window_set_skip_pager_hint(GTK_WINDOW(self), TRUE);
    gtk_window_set_accept_focus(GTK_WINDOW(self), FALSE);
    gtk_window_set_focus_on_map(GTK_WINDOW(self), FALSE);
    gtk_window_stick(GTK_WINDOW(self));

    self_set_layout(self);
    self_set_title_font(self);

    if (eel_gconf_get_boolean(MN_CONF_MAIL_SUMMARY_POPUP_AUTOCLOSE))
      self_install_timeout(self);

    mn_g_object_gconf_notifications_add_gdk_locked(self,
						   MN_CONF_MAIL_SUMMARY_POPUP_AUTOCLOSE, self_notify_autoclose_cb, self,
						   MN_CONF_MAIL_SUMMARY_POPUP_AUTOCLOSE_DELAY_NAMESPACE, self_notify_delay_cb, self,
						   MN_CONF_MAIL_SUMMARY_POPUP_LAYOUT, self_notify_layout_cb, self,
						   MN_CONF_MAIL_SUMMARY_POPUP_POSITION, self_notify_geometry_cb, self,
						   MN_CONF_MAIL_SUMMARY_POPUP_OFFSET_NAMESPACE, self_notify_geometry_cb, self,
						   MN_CONF_MAIL_SUMMARY_POPUP_FONTS_ASPECT_SOURCE, self_notify_fonts_aspect_source_cb, self,
						   MN_CONF_MAIL_SUMMARY_POPUP_FONTS_TITLE_FONT, self_notify_fonts_title_font_cb, self,
						   MN_CONF_MAIL_SUMMARY_POPUP_FONTS_CONTENTS_FONT, self_notify_fonts_contents_font_cb, self,
						   NULL);

    g_object_connect(self,
		     "signal::realize", self_realize_set_decorations_h, NULL,
		     "signal::realize", self_realize_set_geometry_h, NULL,
		     NULL);
  
#line 259 "mn-mail-summary-popup.c"
 }
}
#undef __GOB_FUNCTION__



#line 125 "mn-mail-summary-popup.gob"
static void 
___2_mn_mail_summary_popup_finalize (GObject * object G_GNUC_UNUSED)
#line 269 "mn-mail-summary-popup.c"
#define PARENT_HANDLER(___object) \
	{ if(G_OBJECT_CLASS(parent_class)->finalize) \
		(* G_OBJECT_CLASS(parent_class)->finalize)(___object); }
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::finalize"
{
#line 127 "mn-mail-summary-popup.gob"
	
    Self *self = SELF(object);

    if (selfp->timeout_source)
      mn_locked_g_source_remove(selfp->timeout_source);

    PARENT_HANDLER(object);
  }}
#line 285 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__
#undef PARENT_HANDLER

#line 136 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_realize_set_decorations_h (MNMailSummaryPopup * self, gpointer user_data)
#line 292 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::realize_set_decorations_h"
#line 136 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 136 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 299 "mn-mail-summary-popup.c"
{
#line 138 "mn-mail-summary-popup.gob"
	
    /*
     * gdk_window_set_decorations() needs the widget's GdkWindow, this
     * is why we must call it after the widget is realized.
     */
    gdk_window_set_decorations(GTK_WIDGET(self)->window, GDK_DECOR_BORDER);
  }}
#line 309 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 146 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_realize_set_geometry_h (MNMailSummaryPopup * self, gpointer user_data)
#line 315 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::realize_set_geometry_h"
#line 146 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 146 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 322 "mn-mail-summary-popup.c"
{
#line 148 "mn-mail-summary-popup.gob"
	
    /* one shot */
    g_signal_handlers_disconnect_by_func(self, self_realize_set_geometry_h, NULL);
    self_set_geometry(self);
  }}
#line 330 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 154 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_notify_autoclose_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data)
#line 336 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::notify_autoclose_cb"
{
#line 159 "mn-mail-summary-popup.gob"
	
    Self *self = user_data;

    if (eel_gconf_get_boolean(MN_CONF_MAIL_SUMMARY_POPUP_AUTOCLOSE))
      {
	if (! selfp->timeout_source)
	  self_install_timeout(self);
      }
    else
      mn_locked_g_source_clear(&selfp->timeout_source);
  }}
#line 352 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 171 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_notify_delay_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data)
#line 358 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::notify_delay_cb"
{
#line 176 "mn-mail-summary-popup.gob"
	
    Self *self = user_data;

    self_reset_timeout(self);
  }}
#line 368 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 182 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_notify_layout_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data)
#line 374 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::notify_layout_cb"
{
#line 187 "mn-mail-summary-popup.gob"
	
    Self *self = user_data;

    self_set_layout(self);
  }}
#line 384 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 193 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_notify_geometry_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data)
#line 390 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::notify_geometry_cb"
{
#line 198 "mn-mail-summary-popup.gob"
	
    Self *self = user_data;

    self_set_geometry(self);
  }}
#line 400 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 204 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_notify_fonts_aspect_source_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data)
#line 406 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::notify_fonts_aspect_source_cb"
{
#line 209 "mn-mail-summary-popup.gob"
	
    Self *self = user_data;

    self_set_title_font(self);
    self_set_contents_font(self);
  }}
#line 417 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 216 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_notify_fonts_title_font_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data)
#line 423 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::notify_fonts_title_font_cb"
{
#line 221 "mn-mail-summary-popup.gob"
	
    Self *self = user_data;

    self_set_title_font(self);
  }}
#line 433 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 227 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_notify_fonts_contents_font_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data)
#line 439 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::notify_fonts_contents_font_cb"
{
#line 232 "mn-mail-summary-popup.gob"
	
    Self *self = user_data;

    self_set_contents_font(self);
  }}
#line 449 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 238 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_install_timeout (MNMailSummaryPopup * self)
#line 455 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::install_timeout"
#line 238 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 238 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 462 "mn-mail-summary-popup.c"
{
#line 240 "mn-mail-summary-popup.gob"
	
    g_return_if_fail(selfp->timeout_source == NULL);

    selfp->timeout_source = mn_conf_timeout_add_gdk_locked(MN_CONF_MAIL_SUMMARY_POPUP_AUTOCLOSE_DELAY_MINUTES,
							   MN_CONF_MAIL_SUMMARY_POPUP_AUTOCLOSE_DELAY_SECONDS,
							   self_timeout_cb,
							   self);
  }}
#line 473 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 249 "mn-mail-summary-popup.gob"
static gboolean 
mn_mail_summary_popup_timeout_cb (gpointer data)
#line 479 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::timeout_cb"
{
#line 251 "mn-mail-summary-popup.gob"
	
    Self *self = data;

    gtk_widget_destroy(GTK_WIDGET(self));

    return FALSE;		/* remove timeout */
  }}
#line 491 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 259 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_set_layout (MNMailSummaryPopup * self)
#line 497 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::set_layout"
#line 259 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 259 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 504 "mn-mail-summary-popup.c"
{
#line 261 "mn-mail-summary-popup.gob"
	
    if (selfp->message_view)
      gtk_widget_destroy(selfp->message_view);

    switch (mn_conf_get_enum_value(MN_TYPE_MAIL_SUMMARY_POPUP_LAYOUT, MN_CONF_MAIL_SUMMARY_POPUP_LAYOUT))
      {
      case MN_MAIL_SUMMARY_POPUP_LAYOUT_STANDARD:
	gtk_image_set_from_stock(GTK_IMAGE(selfp->image), MN_STOCK_MAIL_SUMMARY, -1);
	/* translators: header capitalization */
	gtk_label_set_markup(GTK_LABEL(selfp->title), _("<span size=\"larger\" weight=\"bold\">Mail Summary</span>"));
	selfp->message_view = mn_standard_message_view_new();
	break;

      case MN_MAIL_SUMMARY_POPUP_LAYOUT_COMPACT:
	gtk_image_set_from_stock(GTK_IMAGE(selfp->image), MN_STOCK_MAIL_SUMMARY, GTK_ICON_SIZE_SMALL_TOOLBAR);
	/* translators: header capitalization */
	gtk_label_set_markup(GTK_LABEL(selfp->title), _("<span weight=\"bold\">Mail Summary</span>"));
	selfp->message_view = mn_compact_message_view_new();
	break;

      default:
	g_assert_not_reached();
	break;
      }

    gtk_widget_set_name(selfp->message_view, "mn-message-view");
    mn_message_view_set_messages(MN_MESSAGE_VIEW(selfp->message_view), selfp->messages);
    gtk_widget_show(selfp->message_view);

    gtk_box_pack_start(GTK_BOX(selfp->vbox), selfp->message_view, TRUE, TRUE, 0);
    g_signal_connect_swapped(selfp->message_view, "button-press-event", G_CALLBACK(self_button_press_event_h), self);

    self_set_contents_font(self);
  }}
#line 541 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 296 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_set_geometry (MNMailSummaryPopup * self)
#line 547 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::set_geometry"
#line 296 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 296 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 554 "mn-mail-summary-popup.c"
{
#line 298 "mn-mail-summary-popup.gob"
	
    MNPosition position;
    int horizontal_offset;
    int vertical_offset;
    int popup_width;
    int popup_height;
    int screen_width;
    int screen_height;
    GdkGravity gravity_mapping[] = {
      GDK_GRAVITY_NORTH_WEST,
      GDK_GRAVITY_NORTH_EAST,
      GDK_GRAVITY_SOUTH_WEST,
      GDK_GRAVITY_SOUTH_EAST
    };
    GdkGravity gravity;
    int x;
    int y;
    gboolean reshow = FALSE;

    position = mn_conf_get_enum_value(MN_TYPE_POSITION, MN_CONF_MAIL_SUMMARY_POPUP_POSITION);
    horizontal_offset = eel_gconf_get_integer(MN_CONF_MAIL_SUMMARY_POPUP_HORIZONTAL_OFFSET);
    vertical_offset = eel_gconf_get_integer(MN_CONF_MAIL_SUMMARY_POPUP_VERTICAL_OFFSET);

    gtk_window_get_size(GTK_WINDOW(self), &popup_width, &popup_height);
    screen_width = gdk_screen_width();
    screen_height = gdk_screen_height();

    g_assert(position >= 0 && position < G_N_ELEMENTS(gravity_mapping));
    gravity = gravity_mapping[position];

    x = (gravity == GDK_GRAVITY_NORTH_WEST || gravity == GDK_GRAVITY_SOUTH_WEST)
      ? horizontal_offset
      : screen_width - popup_width - horizontal_offset;
    y = (gravity == GDK_GRAVITY_NORTH_WEST || gravity == GDK_GRAVITY_NORTH_EAST)
      ? vertical_offset
      : screen_height - popup_height - vertical_offset;

    /*
     * If the gravity changes, the gtk_window_move() call will misplace
     * the window (probably a Metacity bug).
     *
     * A workaround is to reshow the window.
     */
    if (gravity != selfp->gravity)
      {
	if (selfp->gravity != -1)
	  reshow = TRUE;

	selfp->gravity = gravity;
      }

    if (reshow)
      {
	gtk_widget_hide(GTK_WIDGET(self));

	/*
	 * If we do not unrealize the window, it will appear in the
	 * task bar the next time we show it.
	 */
	gtk_widget_unrealize(GTK_WIDGET(self));
      }

    gtk_window_set_gravity(GTK_WINDOW(self), gravity);
    gtk_window_move(GTK_WINDOW(self), x, y);

    if (reshow)
      gtk_widget_show(GTK_WIDGET(self));
  }}
#line 625 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 367 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_set_title_font (MNMailSummaryPopup * self)
#line 631 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::set_title_font"
#line 367 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 367 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 638 "mn-mail-summary-popup.c"
{
#line 369 "mn-mail-summary-popup.gob"
	
    self_set_font(self, selfp->title, MN_CONF_MAIL_SUMMARY_POPUP_FONTS_TITLE_FONT);
  }}
#line 644 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 373 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_set_contents_font (MNMailSummaryPopup * self)
#line 650 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::set_contents_font"
#line 373 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 373 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 657 "mn-mail-summary-popup.c"
{
#line 375 "mn-mail-summary-popup.gob"
	
    self_set_font(self, selfp->message_view, MN_CONF_MAIL_SUMMARY_POPUP_FONTS_CONTENTS_FONT);
  }}
#line 663 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 379 "mn-mail-summary-popup.gob"
static void 
mn_mail_summary_popup_set_font (MNMailSummaryPopup * self, GtkWidget * widget, const char * conf_key)
#line 669 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::set_font"
#line 379 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 379 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 379 "mn-mail-summary-popup.gob"
	g_return_if_fail (widget != NULL);
#line 379 "mn-mail-summary-popup.gob"
	g_return_if_fail (GTK_IS_WIDGET (widget));
#line 379 "mn-mail-summary-popup.gob"
	g_return_if_fail (conf_key != NULL);
#line 682 "mn-mail-summary-popup.c"
{
#line 383 "mn-mail-summary-popup.gob"
	
    PangoFontDescription *font_desc = NULL;

    if (mn_conf_get_enum_value(MN_TYPE_ASPECT_SOURCE, MN_CONF_MAIL_SUMMARY_POPUP_FONTS_ASPECT_SOURCE) == MN_ASPECT_SOURCE_CUSTOM)
      {
	char *str;

	str = eel_gconf_get_string(conf_key);
	if (str)
	  {
	    font_desc = pango_font_description_from_string(str);
	    g_free(str);
	  }
      }

    gtk_widget_modify_font(widget, font_desc);
    if (font_desc)
      pango_font_description_free(font_desc);
  }}
#line 704 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 403 "mn-mail-summary-popup.gob"
void 
mn_mail_summary_popup_set_messages (MNMailSummaryPopup * self, GSList * messages)
#line 710 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::set_messages"
#line 403 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 403 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 403 "mn-mail-summary-popup.gob"
	g_return_if_fail (messages != NULL);
#line 719 "mn-mail-summary-popup.c"
{
#line 405 "mn-mail-summary-popup.gob"
	
    mn_g_object_slist_free(selfp->messages);
    selfp->messages = mn_g_object_slist_copy(messages);

    g_object_set(selfp->message_view, "messages", selfp->messages, NULL);
  }}
#line 728 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 412 "mn-mail-summary-popup.gob"
void 
mn_mail_summary_popup_reset_timeout (MNMailSummaryPopup * self)
#line 734 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::reset_timeout"
#line 412 "mn-mail-summary-popup.gob"
	g_return_if_fail (self != NULL);
#line 412 "mn-mail-summary-popup.gob"
	g_return_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self));
#line 741 "mn-mail-summary-popup.c"
{
#line 414 "mn-mail-summary-popup.gob"
	
    if (eel_gconf_get_boolean(MN_CONF_MAIL_SUMMARY_POPUP_AUTOCLOSE))
      {
	mn_locked_g_source_clear(&selfp->timeout_source);
	self_install_timeout(self);
      }
  }}
#line 751 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 422 "mn-mail-summary-popup.gob"
GtkWidget * 
mn_mail_summary_popup_new (void)
#line 757 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::new"
{
#line 424 "mn-mail-summary-popup.gob"
	
    return GTK_WIDGET(GET_NEW);
  }}
#line 765 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__

#line 430 "mn-mail-summary-popup.gob"
gboolean 
mn_mail_summary_popup_button_press_event_h (MNMailSummaryPopup * self, GdkEventButton * button, GtkWidget * widget)
#line 771 "mn-mail-summary-popup.c"
{
#define __GOB_FUNCTION__ "MN:Mail:Summary:Popup::button_press_event_h"
#line 430 "mn-mail-summary-popup.gob"
	g_return_val_if_fail (self != NULL, (gboolean )0);
#line 430 "mn-mail-summary-popup.gob"
	g_return_val_if_fail (MN_IS_MAIL_SUMMARY_POPUP (self), (gboolean )0);
#line 778 "mn-mail-summary-popup.c"
{
#line 432 "mn-mail-summary-popup.gob"
	
    gtk_widget_destroy(GTK_WIDGET(self));

    return TRUE;		/* do not propagate event */
  }}
#line 786 "mn-mail-summary-popup.c"
#undef __GOB_FUNCTION__
