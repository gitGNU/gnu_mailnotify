/* Generated by GOB (v2.0.11) on Sun Mar  6 22:34:27 2005
   (do not edit directly) */

/* End world hunger, donate to the World Food Programme, http://www.wfp.org */

#define GOB_VERSION_MAJOR 2
#define GOB_VERSION_MINOR 0
#define GOB_VERSION_PATCHLEVEL 11

#define selfp (self->_priv)

#include <string.h> /* memset() */

#include "mn-mailboxes.h"

#include "mn-mailboxes-private.h"

#ifdef G_LIKELY
#define ___GOB_LIKELY(expr) G_LIKELY(expr)
#define ___GOB_UNLIKELY(expr) G_UNLIKELY(expr)
#else /* ! G_LIKELY */
#define ___GOB_LIKELY(expr) (expr)
#define ___GOB_UNLIKELY(expr) (expr)
#endif /* G_LIKELY */

#line 24 "mn-mailboxes.gob"

#include "config.h"
#include <glib/gi18n.h>
#include <eel/eel.h>
#include "mn-conf.h"
#include "mn-util.h"
#include "mn-pending-mailbox.h"
#include "mn-unsupported-mailbox.h"

#line 37 "mn-mailboxes.c"
/* self casting macros */
#define SELF(x) MN_MAILBOXES(x)
#define SELF_CONST(x) MN_MAILBOXES_CONST(x)
#define IS_SELF(x) MN_IS_MAILBOXES(x)
#define TYPE_SELF MN_TYPE_MAILBOXES
#define SELF_CLASS(x) MN_MAILBOXES_CLASS(x)

#define SELF_GET_CLASS(x) MN_MAILBOXES_GET_CLASS(x)

/* self typedefs */
typedef MNMailboxes Self;
typedef MNMailboxesClass SelfClass;

/* here are local prototypes */
static void ___object_get_property (GObject *object, guint property_id, GValue *value, GParamSpec *pspec);
static void mn_mailboxes_class_init (MNMailboxesClass * c) G_GNUC_UNUSED;
static void mn_mailboxes_mailbox_added (MNMailboxes * self, MNMailbox * mailbox) G_GNUC_UNUSED;
static void mn_mailboxes_mailbox_changed (MNMailboxes * self, MNMailbox * mailbox) G_GNUC_UNUSED;
static void ___real_mn_mailboxes_mailbox_removed (MNMailboxes * self, MNMailbox * mailbox);
static void mn_mailboxes_mailbox_removed (MNMailboxes * self, MNMailbox * mailbox) G_GNUC_UNUSED;
static void ___real_mn_mailboxes_list_changed (MNMailboxes * self);
static void mn_mailboxes_list_changed (MNMailboxes * self) G_GNUC_UNUSED;
static void mn_mailboxes_messages_changed (MNMailboxes * self, gboolean has_new) G_GNUC_UNUSED;
static void mn_mailboxes_error_changed (MNMailboxes * self) G_GNUC_UNUSED;
static void mn_mailboxes_init (MNMailboxes * self) G_GNUC_UNUSED;
static void ___9_mn_mailboxes_finalize (GObject * object) G_GNUC_UNUSED;
static void mn_mailboxes_notify_delay_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data) G_GNUC_UNUSED;
static void mn_mailboxes_notify_mailboxes_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data) G_GNUC_UNUSED;
static void mn_mailboxes_update_from_conf (MNMailboxes * self) G_GNUC_UNUSED;
static void mn_mailboxes_new_cb (MNMailbox * mailbox, gpointer user_data) G_GNUC_UNUSED;
static void mn_mailboxes_messages_changed_h (MNMailbox * mailbox, gboolean has_new, gpointer user_data) G_GNUC_UNUSED;
static void mn_mailboxes_notify_error_h (GObject * object, GParamSpec * pspec, gpointer user_data) G_GNUC_UNUSED;
static void mn_mailboxes_notify_must_poll_h (GObject * object, GParamSpec * pspec, gpointer user_data) G_GNUC_UNUSED;
static void mn_mailboxes_install_timeout (MNMailboxes * self) G_GNUC_UNUSED;
static gboolean mn_mailboxes_timeout_cb (gpointer data) G_GNUC_UNUSED;
static int mn_mailboxes_find_compare_func (gconstpointer a, gconstpointer b) G_GNUC_UNUSED;
static int mn_mailboxes_conf_find_compare_func (gconstpointer a, gconstpointer b) G_GNUC_UNUSED;

/*
 * Signal connection wrapper macro shortcuts
 */
#define self_connect__mailbox_added(object,func,data)	mn_mailboxes_connect__mailbox_added((object),(func),(data))
#define self_connect_after__mailbox_added(object,func,data)	mn_mailboxes_connect_after__mailbox_added((object),(func),(data))
#define self_connect_data__mailbox_added(object,func,data,destroy_data,flags)	mn_mailboxes_connect_data__mailbox_added((object),(func),(data),(destroy_data),(flags))
#define self_connect__mailbox_changed(object,func,data)	mn_mailboxes_connect__mailbox_changed((object),(func),(data))
#define self_connect_after__mailbox_changed(object,func,data)	mn_mailboxes_connect_after__mailbox_changed((object),(func),(data))
#define self_connect_data__mailbox_changed(object,func,data,destroy_data,flags)	mn_mailboxes_connect_data__mailbox_changed((object),(func),(data),(destroy_data),(flags))
#define self_connect__mailbox_removed(object,func,data)	mn_mailboxes_connect__mailbox_removed((object),(func),(data))
#define self_connect_after__mailbox_removed(object,func,data)	mn_mailboxes_connect_after__mailbox_removed((object),(func),(data))
#define self_connect_data__mailbox_removed(object,func,data,destroy_data,flags)	mn_mailboxes_connect_data__mailbox_removed((object),(func),(data),(destroy_data),(flags))
#define self_connect__list_changed(object,func,data)	mn_mailboxes_connect__list_changed((object),(func),(data))
#define self_connect_after__list_changed(object,func,data)	mn_mailboxes_connect_after__list_changed((object),(func),(data))
#define self_connect_data__list_changed(object,func,data,destroy_data,flags)	mn_mailboxes_connect_data__list_changed((object),(func),(data),(destroy_data),(flags))
#define self_connect__messages_changed(object,func,data)	mn_mailboxes_connect__messages_changed((object),(func),(data))
#define self_connect_after__messages_changed(object,func,data)	mn_mailboxes_connect_after__messages_changed((object),(func),(data))
#define self_connect_data__messages_changed(object,func,data,destroy_data,flags)	mn_mailboxes_connect_data__messages_changed((object),(func),(data),(destroy_data),(flags))
#define self_connect__error_changed(object,func,data)	mn_mailboxes_connect__error_changed((object),(func),(data))
#define self_connect_after__error_changed(object,func,data)	mn_mailboxes_connect_after__error_changed((object),(func),(data))
#define self_connect_data__error_changed(object,func,data,destroy_data,flags)	mn_mailboxes_connect_data__error_changed((object),(func),(data),(destroy_data),(flags))

typedef void  (*___Sig1) (MNMailboxes *, GObject *, gpointer);

static void
___marshal_Sig1 (GClosure *closure,
	GValue *return_value G_GNUC_UNUSED,
	guint n_param_values,
	const GValue *param_values,
	gpointer invocation_hint G_GNUC_UNUSED,
	gpointer marshal_data)
{
	register ___Sig1 callback;
	register GCClosure *cc = (GCClosure*) closure;
	register gpointer data1, data2;

	g_return_if_fail (n_param_values == 2);

	if (G_CCLOSURE_SWAP_DATA (closure)) {
		data1 = closure->data;
		data2 = g_value_peek_pointer (param_values + 0);
	} else {
		data1 = g_value_peek_pointer (param_values + 0);
		data2 = closure->data;
	}

	callback = (___Sig1) (marshal_data != NULL ? marshal_data : cc->callback);

	callback ((MNMailboxes *)data1,
		(GObject *) g_value_get_object (param_values + 1),
		data2);
}


typedef void  (*___Sig2) (MNMailboxes *, gboolean , gpointer);

static void
___marshal_Sig2 (GClosure *closure,
	GValue *return_value G_GNUC_UNUSED,
	guint n_param_values,
	const GValue *param_values,
	gpointer invocation_hint G_GNUC_UNUSED,
	gpointer marshal_data)
{
	register ___Sig2 callback;
	register GCClosure *cc = (GCClosure*) closure;
	register gpointer data1, data2;

	g_return_if_fail (n_param_values == 2);

	if (G_CCLOSURE_SWAP_DATA (closure)) {
		data1 = closure->data;
		data2 = g_value_peek_pointer (param_values + 0);
	} else {
		data1 = g_value_peek_pointer (param_values + 0);
		data2 = closure->data;
	}

	callback = (___Sig2) (marshal_data != NULL ? marshal_data : cc->callback);

	callback ((MNMailboxes *)data1,
		(gboolean ) g_value_get_boolean (param_values + 1),
		data2);
}


enum {
	MAILBOX_ADDED_SIGNAL,
	MAILBOX_CHANGED_SIGNAL,
	MAILBOX_REMOVED_SIGNAL,
	LIST_CHANGED_SIGNAL,
	MESSAGES_CHANGED_SIGNAL,
	ERROR_CHANGED_SIGNAL,
	LAST_SIGNAL
};

enum {
	PROP_0,
	PROP_MUST_POLL
};

static guint object_signals[LAST_SIGNAL] = {0};

/* pointer to the class of our parent */
static GObjectClass *parent_class = NULL;

/* Short form macros */
#define self_mailbox_added mn_mailboxes_mailbox_added
#define self_mailbox_changed mn_mailboxes_mailbox_changed
#define self_mailbox_removed mn_mailboxes_mailbox_removed
#define self_list_changed mn_mailboxes_list_changed
#define self_messages_changed mn_mailboxes_messages_changed
#define self_error_changed mn_mailboxes_error_changed
#define self_get_must_poll mn_mailboxes_get_must_poll
#define self_notify_delay_cb mn_mailboxes_notify_delay_cb
#define self_notify_mailboxes_cb mn_mailboxes_notify_mailboxes_cb
#define self_update_from_conf mn_mailboxes_update_from_conf
#define self_new_cb mn_mailboxes_new_cb
#define self_messages_changed_h mn_mailboxes_messages_changed_h
#define self_notify_error_h mn_mailboxes_notify_error_h
#define self_notify_must_poll_h mn_mailboxes_notify_must_poll_h
#define self_install_timeout mn_mailboxes_install_timeout
#define self_timeout_cb mn_mailboxes_timeout_cb
#define self_check mn_mailboxes_check
#define self_get mn_mailboxes_get
#define self_get_messages mn_mailboxes_get_messages
#define self_find mn_mailboxes_find
#define self_find_uri mn_mailboxes_find_uri
#define self_find_compare_func mn_mailboxes_find_compare_func
#define self_conf_find_uri mn_mailboxes_conf_find_uri
#define self_conf_find_compare_func mn_mailboxes_conf_find_compare_func
#define self_new mn_mailboxes_new
GType
mn_mailboxes_get_type (void)
{
	static GType type = 0;

	if ___GOB_UNLIKELY(type == 0) {
		static const GTypeInfo info = {
			sizeof (MNMailboxesClass),
			(GBaseInitFunc) NULL,
			(GBaseFinalizeFunc) NULL,
			(GClassInitFunc) mn_mailboxes_class_init,
			(GClassFinalizeFunc) NULL,
			NULL /* class_data */,
			sizeof (MNMailboxes),
			0 /* n_preallocs */,
			(GInstanceInitFunc) mn_mailboxes_init,
			NULL
		};

		type = g_type_register_static (G_TYPE_OBJECT, "MNMailboxes", &info, (GTypeFlags)0);
	}

	return type;
}

/* a macro for creating a new object of our type */
#define GET_NEW ((MNMailboxes *)g_object_new(mn_mailboxes_get_type(), NULL))

/* a function for creating a new object of our type */
#include <stdarg.h>
static MNMailboxes * GET_NEW_VARG (const char *first, ...) G_GNUC_UNUSED;
static MNMailboxes *
GET_NEW_VARG (const char *first, ...)
{
	MNMailboxes *ret;
	va_list ap;
	va_start (ap, first);
	ret = (MNMailboxes *)g_object_new_valist (mn_mailboxes_get_type (), first, ap);
	va_end (ap);
	return ret;
}


static void
___finalize(GObject *obj_self)
{
#define __GOB_FUNCTION__ "MN:Mailboxes::finalize"
	MNMailboxes *self G_GNUC_UNUSED = MN_MAILBOXES (obj_self);
	gpointer priv G_GNUC_UNUSED = self->_priv;
#line 156 "mn-mailboxes.gob"
	___9_mn_mailboxes_finalize(obj_self);
#line 259 "mn-mailboxes.c"
#line 36 "mn-mailboxes.gob"
	if(self->_priv->list) { mn_g_object_slist_free ((gpointer) self->_priv->list); self->_priv->list = NULL; }
#line 262 "mn-mailboxes.c"
}
#undef __GOB_FUNCTION__

static void 
mn_mailboxes_class_init (MNMailboxesClass * c G_GNUC_UNUSED)
{
#define __GOB_FUNCTION__ "MN:Mailboxes::class_init"
	GObjectClass *g_object_class G_GNUC_UNUSED = (GObjectClass*) c;

	g_type_class_add_private(c,sizeof(MNMailboxesPrivate));

	parent_class = g_type_class_ref (G_TYPE_OBJECT);

	object_signals[MAILBOX_ADDED_SIGNAL] =
		g_signal_new ("mailbox_added",
			G_TYPE_FROM_CLASS (g_object_class),
			(GSignalFlags)(G_SIGNAL_RUN_LAST),
			G_STRUCT_OFFSET (MNMailboxesClass, mailbox_added),
			NULL, NULL,
			___marshal_Sig1,
			G_TYPE_NONE, 1,
			G_TYPE_OBJECT);
	if ___GOB_UNLIKELY(sizeof(MNMailbox * ) != sizeof(GObject *) || parent_class == NULL /* avoid warning */) {
		g_error("mn-mailboxes.gob line 46: Type mismatch of \"mailbox_added\" signal signature");
	}
	object_signals[MAILBOX_CHANGED_SIGNAL] =
		g_signal_new ("mailbox_changed",
			G_TYPE_FROM_CLASS (g_object_class),
			(GSignalFlags)(G_SIGNAL_RUN_LAST),
			G_STRUCT_OFFSET (MNMailboxesClass, mailbox_changed),
			NULL, NULL,
			___marshal_Sig1,
			G_TYPE_NONE, 1,
			G_TYPE_OBJECT);
	if ___GOB_UNLIKELY(sizeof(MNMailbox * ) != sizeof(GObject *) || parent_class == NULL /* avoid warning */) {
		g_error("mn-mailboxes.gob line 56: Type mismatch of \"mailbox_changed\" signal signature");
	}
	object_signals[MAILBOX_REMOVED_SIGNAL] =
		g_signal_new ("mailbox_removed",
			G_TYPE_FROM_CLASS (g_object_class),
			(GSignalFlags)(G_SIGNAL_RUN_FIRST),
			G_STRUCT_OFFSET (MNMailboxesClass, mailbox_removed),
			NULL, NULL,
			___marshal_Sig1,
			G_TYPE_NONE, 1,
			G_TYPE_OBJECT);
	if ___GOB_UNLIKELY(sizeof(MNMailbox * ) != sizeof(GObject *) || parent_class == NULL /* avoid warning */) {
		g_error("mn-mailboxes.gob line 67: Type mismatch of \"mailbox_removed\" signal signature");
	}
	object_signals[LIST_CHANGED_SIGNAL] =
		g_signal_new ("list_changed",
			G_TYPE_FROM_CLASS (g_object_class),
			(GSignalFlags)(G_SIGNAL_RUN_FIRST),
			G_STRUCT_OFFSET (MNMailboxesClass, list_changed),
			NULL, NULL,
			g_cclosure_marshal_VOID__VOID,
			G_TYPE_NONE, 0);
	object_signals[MESSAGES_CHANGED_SIGNAL] =
		g_signal_new ("messages_changed",
			G_TYPE_FROM_CLASS (g_object_class),
			(GSignalFlags)(G_SIGNAL_RUN_LAST),
			G_STRUCT_OFFSET (MNMailboxesClass, messages_changed),
			NULL, NULL,
			___marshal_Sig2,
			G_TYPE_NONE, 1,
			G_TYPE_BOOLEAN);
	if ___GOB_UNLIKELY(sizeof(gboolean ) != sizeof(gboolean ) || parent_class == NULL /* avoid warning */) {
		g_error("mn-mailboxes.gob line 115: Type mismatch of \"messages_changed\" signal signature");
	}
	object_signals[ERROR_CHANGED_SIGNAL] =
		g_signal_new ("error_changed",
			G_TYPE_FROM_CLASS (g_object_class),
			(GSignalFlags)(G_SIGNAL_RUN_LAST),
			G_STRUCT_OFFSET (MNMailboxesClass, error_changed),
			NULL, NULL,
			g_cclosure_marshal_VOID__VOID,
			G_TYPE_NONE, 0);

	c->mailbox_added = NULL;
	c->mailbox_changed = NULL;
#line 67 "mn-mailboxes.gob"
	c->mailbox_removed = ___real_mn_mailboxes_mailbox_removed;
#line 93 "mn-mailboxes.gob"
	c->list_changed = ___real_mn_mailboxes_list_changed;
#line 347 "mn-mailboxes.c"
	c->messages_changed = NULL;
	c->error_changed = NULL;
#line 156 "mn-mailboxes.gob"
	g_object_class->finalize = ___finalize;
#line 352 "mn-mailboxes.c"
	g_object_class->get_property = ___object_get_property;
    {
	GParamSpec   *param_spec;

	param_spec = g_param_spec_boolean
		("must_poll" /* name */,
		 NULL /* nick */,
		 _("Whether one or more of the mailboxes has to be polled") /* blurb */,
		 FALSE /* default_value */,
		 (GParamFlags)(G_PARAM_READABLE));
	g_object_class_install_property (g_object_class,
		PROP_MUST_POLL,
		param_spec);
    }
}
#undef __GOB_FUNCTION__
#line 147 "mn-mailboxes.gob"
static void 
mn_mailboxes_init (MNMailboxes * self G_GNUC_UNUSED)
#line 372 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::init"
	self->_priv = G_TYPE_INSTANCE_GET_PRIVATE(self,TYPE_SELF,MNMailboxesPrivate);
 {
#line 148 "mn-mailboxes.gob"

    self_update_from_conf(self);
    self_install_timeout(self);

    mn_conf_notification_add(self, MN_CONF_DELAY_NAMESPACE, self_notify_delay_cb, self);
    mn_conf_notification_add(self, MN_CONF_MAILBOXES, self_notify_mailboxes_cb, self);
  
#line 385 "mn-mailboxes.c"
 }
}
#undef __GOB_FUNCTION__

static void
___object_get_property (GObject *object,
	guint property_id,
	GValue *VAL G_GNUC_UNUSED,
	GParamSpec *pspec G_GNUC_UNUSED)
#define __GOB_FUNCTION__ "MN:Mailboxes::get_property"
{
	MNMailboxes *self G_GNUC_UNUSED;

	self = MN_MAILBOXES (object);

	switch (property_id) {
	case PROP_MUST_POLL:
		{
#line 133 "mn-mailboxes.gob"

      gboolean must_poll = FALSE;
      GSList *l;

      MN_LIST_FOREACH(l, selfp->list)
	if (MN_MAILBOX_MUST_POLL(l->data))
	  {
	    must_poll = TRUE;
	    break;
	  }

      g_value_set_boolean(VAL, must_poll);
    
#line 418 "mn-mailboxes.c"
		}
		break;
	default:
/* Apparently in g++ this is needed, glib is b0rk */
#ifndef __PRETTY_FUNCTION__
#  undef G_STRLOC
#  define G_STRLOC	__FILE__ ":" G_STRINGIFY (__LINE__)
#endif
		G_OBJECT_WARN_INVALID_PROPERTY_ID (object, property_id, pspec);
		break;
	}
}
#undef __GOB_FUNCTION__


#line 46 "mn-mailboxes.gob"
static void 
mn_mailboxes_mailbox_added (MNMailboxes * self, MNMailbox * mailbox)
#line 437 "mn-mailboxes.c"
{
	GValue ___param_values[2];
	GValue ___return_val;

memset (&___return_val, 0, sizeof (___return_val));
memset (&___param_values, 0, sizeof (___param_values));

#line 46 "mn-mailboxes.gob"
	g_return_if_fail (self != NULL);
#line 46 "mn-mailboxes.gob"
	g_return_if_fail (MN_IS_MAILBOXES (self));
#line 46 "mn-mailboxes.gob"
	g_return_if_fail (mailbox != NULL);
#line 46 "mn-mailboxes.gob"
	g_return_if_fail (MN_IS_MAILBOX (mailbox));
#line 453 "mn-mailboxes.c"

	___param_values[0].g_type = 0;
	g_value_init (&___param_values[0], G_TYPE_FROM_INSTANCE (self));
	g_value_set_instance (&___param_values[0], (gpointer) self);

	___param_values[1].g_type = 0;
	g_value_init (&___param_values[1], G_TYPE_OBJECT);
	g_value_set_object (&___param_values[1], (GObject *) mailbox);

	g_signal_emitv (___param_values,
		object_signals[MAILBOX_ADDED_SIGNAL],
		0 /* detail */,
		&___return_val);

	g_value_unset (&___param_values[0]);
	g_value_unset (&___param_values[1]);
}

#line 56 "mn-mailboxes.gob"
static void 
mn_mailboxes_mailbox_changed (MNMailboxes * self, MNMailbox * mailbox)
#line 475 "mn-mailboxes.c"
{
	GValue ___param_values[2];
	GValue ___return_val;

memset (&___return_val, 0, sizeof (___return_val));
memset (&___param_values, 0, sizeof (___param_values));

#line 56 "mn-mailboxes.gob"
	g_return_if_fail (self != NULL);
#line 56 "mn-mailboxes.gob"
	g_return_if_fail (MN_IS_MAILBOXES (self));
#line 56 "mn-mailboxes.gob"
	g_return_if_fail (mailbox != NULL);
#line 56 "mn-mailboxes.gob"
	g_return_if_fail (MN_IS_MAILBOX (mailbox));
#line 491 "mn-mailboxes.c"

	___param_values[0].g_type = 0;
	g_value_init (&___param_values[0], G_TYPE_FROM_INSTANCE (self));
	g_value_set_instance (&___param_values[0], (gpointer) self);

	___param_values[1].g_type = 0;
	g_value_init (&___param_values[1], G_TYPE_OBJECT);
	g_value_set_object (&___param_values[1], (GObject *) mailbox);

	g_signal_emitv (___param_values,
		object_signals[MAILBOX_CHANGED_SIGNAL],
		0 /* detail */,
		&___return_val);

	g_value_unset (&___param_values[0]);
	g_value_unset (&___param_values[1]);
}

#line 67 "mn-mailboxes.gob"
static void 
mn_mailboxes_mailbox_removed (MNMailboxes * self, MNMailbox * mailbox)
#line 513 "mn-mailboxes.c"
{
	GValue ___param_values[2];
	GValue ___return_val;

memset (&___return_val, 0, sizeof (___return_val));
memset (&___param_values, 0, sizeof (___param_values));

#line 67 "mn-mailboxes.gob"
	g_return_if_fail (self != NULL);
#line 67 "mn-mailboxes.gob"
	g_return_if_fail (MN_IS_MAILBOXES (self));
#line 67 "mn-mailboxes.gob"
	g_return_if_fail (mailbox != NULL);
#line 67 "mn-mailboxes.gob"
	g_return_if_fail (MN_IS_MAILBOX (mailbox));
#line 529 "mn-mailboxes.c"

	___param_values[0].g_type = 0;
	g_value_init (&___param_values[0], G_TYPE_FROM_INSTANCE (self));
	g_value_set_instance (&___param_values[0], (gpointer) self);

	___param_values[1].g_type = 0;
	g_value_init (&___param_values[1], G_TYPE_OBJECT);
	g_value_set_object (&___param_values[1], (GObject *) mailbox);

	g_signal_emitv (___param_values,
		object_signals[MAILBOX_REMOVED_SIGNAL],
		0 /* detail */,
		&___return_val);

	g_value_unset (&___param_values[0]);
	g_value_unset (&___param_values[1]);
}
#line 67 "mn-mailboxes.gob"
static void 
___real_mn_mailboxes_mailbox_removed (MNMailboxes * self G_GNUC_UNUSED, MNMailbox * mailbox)
#line 550 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::mailbox_removed"
{
#line 69 "mn-mailboxes.gob"
	
    /* disconnect signals */
    g_object_disconnect(mailbox,
			"any-signal", self_messages_changed_h, self,
			"any-signal", self_notify_error_h, self,
			"any-signal", self_notify_must_poll_h, self,
			NULL);

    /* emit the "removed" signal on the mailbox */
    mn_mailbox_removed(mailbox);

    /* messages and error have possibly changed */
    self_messages_changed(self, FALSE);
    self_error_changed(self);
  }}
#line 570 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 93 "mn-mailboxes.gob"
static void 
mn_mailboxes_list_changed (MNMailboxes * self)
#line 576 "mn-mailboxes.c"
{
	GValue ___param_values[1];
	GValue ___return_val;

memset (&___return_val, 0, sizeof (___return_val));
memset (&___param_values, 0, sizeof (___param_values));

#line 93 "mn-mailboxes.gob"
	g_return_if_fail (self != NULL);
#line 93 "mn-mailboxes.gob"
	g_return_if_fail (MN_IS_MAILBOXES (self));
#line 588 "mn-mailboxes.c"

	___param_values[0].g_type = 0;
	g_value_init (&___param_values[0], G_TYPE_FROM_INSTANCE (self));
	g_value_set_instance (&___param_values[0], (gpointer) self);

	g_signal_emitv (___param_values,
		object_signals[LIST_CHANGED_SIGNAL],
		0 /* detail */,
		&___return_val);

	g_value_unset (&___param_values[0]);
}
#line 93 "mn-mailboxes.gob"
static void 
___real_mn_mailboxes_list_changed (MNMailboxes * self G_GNUC_UNUSED)
#line 604 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::list_changed"
{
#line 95 "mn-mailboxes.gob"
	
    /* must-poll has possibly changed */
    g_object_notify(G_OBJECT(self), "must-poll");
  }}
#line 613 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 115 "mn-mailboxes.gob"
static void 
mn_mailboxes_messages_changed (MNMailboxes * self, gboolean has_new)
#line 619 "mn-mailboxes.c"
{
	GValue ___param_values[2];
	GValue ___return_val;

memset (&___return_val, 0, sizeof (___return_val));
memset (&___param_values, 0, sizeof (___param_values));

#line 115 "mn-mailboxes.gob"
	g_return_if_fail (self != NULL);
#line 115 "mn-mailboxes.gob"
	g_return_if_fail (MN_IS_MAILBOXES (self));
#line 631 "mn-mailboxes.c"

	___param_values[0].g_type = 0;
	g_value_init (&___param_values[0], G_TYPE_FROM_INSTANCE (self));
	g_value_set_instance (&___param_values[0], (gpointer) self);

	___param_values[1].g_type = 0;
	g_value_init (&___param_values[1], G_TYPE_BOOLEAN);
	g_value_set_boolean (&___param_values[1], (gboolean ) has_new);

	g_signal_emitv (___param_values,
		object_signals[MESSAGES_CHANGED_SIGNAL],
		0 /* detail */,
		&___return_val);

	g_value_unset (&___param_values[0]);
	g_value_unset (&___param_values[1]);
}

#line 127 "mn-mailboxes.gob"
static void 
mn_mailboxes_error_changed (MNMailboxes * self)
#line 653 "mn-mailboxes.c"
{
	GValue ___param_values[1];
	GValue ___return_val;

memset (&___return_val, 0, sizeof (___return_val));
memset (&___param_values, 0, sizeof (___param_values));

#line 127 "mn-mailboxes.gob"
	g_return_if_fail (self != NULL);
#line 127 "mn-mailboxes.gob"
	g_return_if_fail (MN_IS_MAILBOXES (self));
#line 665 "mn-mailboxes.c"

	___param_values[0].g_type = 0;
	g_value_init (&___param_values[0], G_TYPE_FROM_INSTANCE (self));
	g_value_set_instance (&___param_values[0], (gpointer) self);

	g_signal_emitv (___param_values,
		object_signals[ERROR_CHANGED_SIGNAL],
		0 /* detail */,
		&___return_val);

	g_value_unset (&___param_values[0]);
}

#line 133 "mn-mailboxes.gob"
gboolean 
mn_mailboxes_get_must_poll (MNMailboxes * self)
#line 682 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::get_must_poll"
{
#line 130 "mn-mailboxes.gob"
		gboolean val; g_object_get (G_OBJECT (self), "must_poll", &val, NULL); return val;
}}
#line 689 "mn-mailboxes.c"
#undef __GOB_FUNCTION__


#line 156 "mn-mailboxes.gob"
static void 
___9_mn_mailboxes_finalize (GObject * object G_GNUC_UNUSED)
#line 696 "mn-mailboxes.c"
#define PARENT_HANDLER(___object) \
	{ if(G_OBJECT_CLASS(parent_class)->finalize) \
		(* G_OBJECT_CLASS(parent_class)->finalize)(___object); }
{
#define __GOB_FUNCTION__ "MN:Mailboxes::finalize"
#line 156 "mn-mailboxes.gob"
	g_return_if_fail (object != NULL);
#line 156 "mn-mailboxes.gob"
	g_return_if_fail (G_IS_OBJECT (object));
#line 706 "mn-mailboxes.c"
{
#line 158 "mn-mailboxes.gob"
	
    Self *self = SELF(object);

    if (selfp->timeout_id)
      g_source_remove(selfp->timeout_id);

    PARENT_HANDLER(object);
  }}
#line 717 "mn-mailboxes.c"
#undef __GOB_FUNCTION__
#undef PARENT_HANDLER

#line 167 "mn-mailboxes.gob"
static void 
mn_mailboxes_notify_delay_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data)
#line 724 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::notify_delay_cb"
#line 167 "mn-mailboxes.gob"
	g_return_if_fail (user_data != NULL);
#line 729 "mn-mailboxes.c"
{
#line 172 "mn-mailboxes.gob"
	
    Self *self = user_data;

    GDK_THREADS_ENTER();
    self_install_timeout(self);
    GDK_THREADS_LEAVE();
  }}
#line 739 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 180 "mn-mailboxes.gob"
static void 
mn_mailboxes_notify_mailboxes_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data)
#line 745 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::notify_mailboxes_cb"
#line 180 "mn-mailboxes.gob"
	g_return_if_fail (user_data != NULL);
#line 750 "mn-mailboxes.c"
{
#line 185 "mn-mailboxes.gob"
	
    Self *self = user_data;

    GDK_THREADS_ENTER();
    self_update_from_conf(self);
    GDK_THREADS_LEAVE();
  }}
#line 760 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 193 "mn-mailboxes.gob"
static void 
mn_mailboxes_update_from_conf (MNMailboxes * self)
#line 766 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::update_from_conf"
#line 193 "mn-mailboxes.gob"
	g_return_if_fail (self != NULL);
#line 193 "mn-mailboxes.gob"
	g_return_if_fail (MN_IS_MAILBOXES (self));
#line 773 "mn-mailboxes.c"
{
#line 195 "mn-mailboxes.gob"
	
    GSList *gconf_mailboxes;
    GSList *l;
    gboolean changed = FALSE;

    gconf_mailboxes = eel_gconf_get_string_list(MN_CONF_MAILBOXES);

    /* first step: remove old mailboxes */

  loop:
    MN_LIST_FOREACH(l, selfp->list)
      {
	MNMailbox *mailbox = l->data;

	if (! self_conf_find_uri(gconf_mailboxes, mailbox->uri))
	  {
	    selfp->list = g_slist_delete_link(selfp->list, l);

	    self_mailbox_removed(self, mailbox);
	    g_object_unref(mailbox);

	    changed = TRUE;
	    goto loop;
	  }
      }

    /* second step: add new mailboxes */

    MN_LIST_FOREACH(l, gconf_mailboxes)
      {
	const char *text_uri = l->data;
	MNURI *uri;
      
	uri = mn_uri_new(text_uri);
	if (! self_find_uri(self, uri))
	  {
	    MNMailbox *mailbox;

	    mailbox = mn_pending_mailbox_new(uri);
	    selfp->list = g_slist_append(selfp->list, mailbox);

	    self_mailbox_added(self, mailbox);
	    changed = TRUE;
	    
	    mn_mailbox_new_async(uri, self_new_cb, self);
	  }
	g_object_unref(uri);
      }

    eel_g_slist_free_deep(gconf_mailboxes);
    if (changed)
      self_list_changed(self);
  }}
#line 829 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 249 "mn-mailboxes.gob"
static void 
mn_mailboxes_new_cb (MNMailbox * mailbox, gpointer user_data)
#line 835 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::new_cb"
#line 249 "mn-mailboxes.gob"
	g_return_if_fail (mailbox != NULL);
#line 249 "mn-mailboxes.gob"
	g_return_if_fail (MN_IS_MAILBOX (mailbox));
#line 249 "mn-mailboxes.gob"
	g_return_if_fail (user_data != NULL);
#line 844 "mn-mailboxes.c"
{
#line 252 "mn-mailboxes.gob"
	
    Self *self = user_data;
    GSList *elem;

    elem = self_find_uri(self, mailbox->uri);
    if (elem)
      {
	if (MN_IS_UNSUPPORTED_MAILBOX(mailbox))
	  mn_info(_("%s is unsupported: %s"), mn_mailbox_get_name(mailbox), mn_unsupported_mailbox_get_reason(MN_UNSUPPORTED_MAILBOX(mailbox)));
	
	g_object_connect(mailbox,
			 "signal::messages-changed", self_messages_changed_h, self,
			 "signal::notify::error", self_notify_error_h, self,
			 "signal::notify::must-poll", self_notify_must_poll_h, self,
			 NULL);

	if (MN_MAILBOX_CAN_CHECK(mailbox))
	  mn_mailbox_check(mailbox);

	g_object_unref(elem->data);
	elem->data = mailbox;

	self_mailbox_changed(self, mailbox);
	self_list_changed(self);
      }
    else
      g_object_unref(mailbox);
  }}
#line 875 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 281 "mn-mailboxes.gob"
static void 
mn_mailboxes_messages_changed_h (MNMailbox * mailbox, gboolean has_new, gpointer user_data)
#line 881 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::messages_changed_h"
#line 281 "mn-mailboxes.gob"
	g_return_if_fail (mailbox != NULL);
#line 281 "mn-mailboxes.gob"
	g_return_if_fail (MN_IS_MAILBOX (mailbox));
#line 281 "mn-mailboxes.gob"
	g_return_if_fail (user_data != NULL);
#line 890 "mn-mailboxes.c"
{
#line 285 "mn-mailboxes.gob"
	
    Self *self = user_data;
    int n_messages;

    n_messages = g_slist_length(mn_mailbox_get_messages(mailbox));
    mn_info(ngettext("%s has %i new message", "%s has %i new messages", n_messages),
	    mn_mailbox_get_name(mailbox), n_messages);
    
    self_messages_changed(self, has_new);
  }}
#line 903 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 296 "mn-mailboxes.gob"
static void 
mn_mailboxes_notify_error_h (GObject * object, GParamSpec * pspec, gpointer user_data)
#line 909 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::notify_error_h"
#line 296 "mn-mailboxes.gob"
	g_return_if_fail (object != NULL);
#line 296 "mn-mailboxes.gob"
	g_return_if_fail (G_IS_OBJECT (object));
#line 296 "mn-mailboxes.gob"
	g_return_if_fail (pspec != NULL);
#line 296 "mn-mailboxes.gob"
	g_return_if_fail (user_data != NULL);
#line 920 "mn-mailboxes.c"
{
#line 300 "mn-mailboxes.gob"
	
    Self *self = user_data;
    MNMailbox *mailbox = MN_MAILBOX(object);
    const char *error;

    error = mn_mailbox_get_error(mailbox);
    if (error)
      mn_info(_("%s reported an error: %s"), mn_mailbox_get_name(mailbox), error);

    self_error_changed(self);
  }}
#line 934 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 312 "mn-mailboxes.gob"
static void 
mn_mailboxes_notify_must_poll_h (GObject * object, GParamSpec * pspec, gpointer user_data)
#line 940 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::notify_must_poll_h"
#line 312 "mn-mailboxes.gob"
	g_return_if_fail (object != NULL);
#line 312 "mn-mailboxes.gob"
	g_return_if_fail (G_IS_OBJECT (object));
#line 312 "mn-mailboxes.gob"
	g_return_if_fail (pspec != NULL);
#line 312 "mn-mailboxes.gob"
	g_return_if_fail (user_data != NULL);
#line 951 "mn-mailboxes.c"
{
#line 316 "mn-mailboxes.gob"
	
    Self *self = user_data;

    /* must-poll has possibly changed */
    g_object_notify(G_OBJECT(self), "must-poll");
  }}
#line 960 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 323 "mn-mailboxes.gob"
static void 
mn_mailboxes_install_timeout (MNMailboxes * self)
#line 966 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::install_timeout"
#line 323 "mn-mailboxes.gob"
	g_return_if_fail (self != NULL);
#line 323 "mn-mailboxes.gob"
	g_return_if_fail (MN_IS_MAILBOXES (self));
#line 973 "mn-mailboxes.c"
{
#line 325 "mn-mailboxes.gob"
	
    mn_source_remove(&selfp->timeout_id);
    selfp->timeout_id = mn_timeout_add(MN_CONF_DELAY_MINUTES,
				       MN_CONF_DELAY_SECONDS,
				       self_timeout_cb,
				       self);
  }}
#line 983 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 333 "mn-mailboxes.gob"
static gboolean 
mn_mailboxes_timeout_cb (gpointer data)
#line 989 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::timeout_cb"
#line 333 "mn-mailboxes.gob"
	g_return_val_if_fail (data != NULL, (gboolean )0);
#line 994 "mn-mailboxes.c"
{
#line 335 "mn-mailboxes.gob"
	
    Self *self = data;

    GDK_THREADS_ENTER();
    self_check(self);
    GDK_THREADS_LEAVE();
    
    return TRUE;		/* continue */
  }}
#line 1006 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 345 "mn-mailboxes.gob"
void 
mn_mailboxes_check (MNMailboxes * self)
#line 1012 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::check"
#line 345 "mn-mailboxes.gob"
	g_return_if_fail (self != NULL);
#line 345 "mn-mailboxes.gob"
	g_return_if_fail (MN_IS_MAILBOXES (self));
#line 1019 "mn-mailboxes.c"
{
#line 347 "mn-mailboxes.gob"
	
    GSList *l;

    MN_LIST_FOREACH(l, selfp->list)
      {
	MNMailbox *mailbox = l->data;

	if (MN_MAILBOX_MUST_POLL(mailbox))
	  mn_mailbox_check(mailbox);
      }
  }}
#line 1033 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 359 "mn-mailboxes.gob"
GSList * 
mn_mailboxes_get (MNMailboxes * self)
#line 1039 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::get"
#line 359 "mn-mailboxes.gob"
	g_return_val_if_fail (self != NULL, (GSList * )0);
#line 359 "mn-mailboxes.gob"
	g_return_val_if_fail (MN_IS_MAILBOXES (self), (GSList * )0);
#line 1046 "mn-mailboxes.c"
{
#line 361 "mn-mailboxes.gob"
	
    return selfp->list;
  }}
#line 1052 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 365 "mn-mailboxes.gob"
GSList * 
mn_mailboxes_get_messages (MNMailboxes * self)
#line 1058 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::get_messages"
#line 365 "mn-mailboxes.gob"
	g_return_val_if_fail (self != NULL, (GSList * )0);
#line 365 "mn-mailboxes.gob"
	g_return_val_if_fail (MN_IS_MAILBOXES (self), (GSList * )0);
#line 1065 "mn-mailboxes.c"
{
#line 367 "mn-mailboxes.gob"
	
    GSList *messages = NULL;
    GSList *l;

    MN_LIST_FOREACH(l, selfp->list)
      {
	MNMailbox *mailbox = l->data;
	messages = g_slist_concat(messages, mn_g_object_slist_copy(mn_mailbox_get_messages(mailbox)));
      }

    messages = mn_message_slist_sort_by_sent_time(messages);
    messages = g_slist_reverse(messages);

    return messages;
  }}
#line 1083 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 383 "mn-mailboxes.gob"
GSList * 
mn_mailboxes_find (MNMailboxes * self, const char * text_uri)
#line 1089 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::find"
#line 383 "mn-mailboxes.gob"
	g_return_val_if_fail (self != NULL, (GSList * )0);
#line 383 "mn-mailboxes.gob"
	g_return_val_if_fail (MN_IS_MAILBOXES (self), (GSList * )0);
#line 383 "mn-mailboxes.gob"
	g_return_val_if_fail (text_uri != NULL, (GSList * )0);
#line 1098 "mn-mailboxes.c"
{
#line 385 "mn-mailboxes.gob"
	
    MNURI *uri;
    GSList *elem;

    uri = mn_uri_new(text_uri);
    elem = self_find_uri(self, uri);
    g_object_unref(uri);

    return elem;
  }}
#line 1111 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 396 "mn-mailboxes.gob"
GSList * 
mn_mailboxes_find_uri (MNMailboxes * self, MNURI * uri)
#line 1117 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::find_uri"
#line 396 "mn-mailboxes.gob"
	g_return_val_if_fail (self != NULL, (GSList * )0);
#line 396 "mn-mailboxes.gob"
	g_return_val_if_fail (MN_IS_MAILBOXES (self), (GSList * )0);
#line 396 "mn-mailboxes.gob"
	g_return_val_if_fail (uri != NULL, (GSList * )0);
#line 396 "mn-mailboxes.gob"
	g_return_val_if_fail (MN_IS_URI (uri), (GSList * )0);
#line 1128 "mn-mailboxes.c"
{
#line 398 "mn-mailboxes.gob"
	
    return g_slist_find_custom(selfp->list, uri, self_find_compare_func);
  }}
#line 1134 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 402 "mn-mailboxes.gob"
static int 
mn_mailboxes_find_compare_func (gconstpointer a, gconstpointer b)
#line 1140 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::find_compare_func"
{
#line 404 "mn-mailboxes.gob"
	
    MNMailbox *mailbox = (MNMailbox *) a;
    MNURI *uri = (MNURI *) b;

    return strcmp(mailbox->uri->text, uri->text);
  }}
#line 1151 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 411 "mn-mailboxes.gob"
GSList * 
mn_mailboxes_conf_find_uri (GSList * gconf_mailboxes, MNURI * uri)
#line 1157 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::conf_find_uri"
#line 411 "mn-mailboxes.gob"
	g_return_val_if_fail (uri != NULL, (GSList * )0);
#line 411 "mn-mailboxes.gob"
	g_return_val_if_fail (MN_IS_URI (uri), (GSList * )0);
#line 1164 "mn-mailboxes.c"
{
#line 413 "mn-mailboxes.gob"
	
    return g_slist_find_custom(gconf_mailboxes, uri, self_conf_find_compare_func);
  }}
#line 1170 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 417 "mn-mailboxes.gob"
static int 
mn_mailboxes_conf_find_compare_func (gconstpointer a, gconstpointer b)
#line 1176 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::conf_find_compare_func"
{
#line 419 "mn-mailboxes.gob"
	
    MNURI *uri_a;
    MNURI *uri_b = (MNURI *) b;
    int cmp;

    uri_a = mn_uri_new(a);
    cmp = strcmp(uri_a->text, uri_b->text);
    g_object_unref(uri_a);

    return cmp;
  }}
#line 1192 "mn-mailboxes.c"
#undef __GOB_FUNCTION__

#line 431 "mn-mailboxes.gob"
MNMailboxes * 
mn_mailboxes_new (void)
#line 1198 "mn-mailboxes.c"
{
#define __GOB_FUNCTION__ "MN:Mailboxes::new"
{
#line 433 "mn-mailboxes.gob"
	
    return GET_NEW;
  }}
#line 1206 "mn-mailboxes.c"
#undef __GOB_FUNCTION__
