/* Generated by GOB (v2.0.12) on Tue Aug  9 22:01:57 2005
   (do not edit directly) */

/* End world hunger, donate to the World Food Programme, http://www.wfp.org */

#define GOB_VERSION_MAJOR 2
#define GOB_VERSION_MINOR 0
#define GOB_VERSION_PATCHLEVEL 12

#define selfp (self->_priv)

#include <string.h> /* memset() */

#include "mn-main-window.h"

#include "mn-main-window-private.h"

#ifdef G_LIKELY
#define ___GOB_LIKELY(expr) G_LIKELY(expr)
#define ___GOB_UNLIKELY(expr) G_UNLIKELY(expr)
#else /* ! G_LIKELY */
#define ___GOB_LIKELY(expr) (expr)
#define ___GOB_UNLIKELY(expr) (expr)
#endif /* G_LIKELY */

#line 29 "mn-main-window.gob"

#include "config.h"
#include <gnome.h>
#include <eel/eel.h>
#include "egg-editable-toolbar.h"
#include "egg-toolbar-editor.h"
#include "mn-util.h"
#include "mn-stock.h"
#include "mn-shell.h"
#include "mn-conf.h"
#include "mn-properties-dialog.h"
#include "mn-message-view.h"

#define STATUS_PUSH(cid, str) \
  gtk_statusbar_push(GTK_STATUSBAR(selfp->statusbar), (cid), (str))
#define STATUS_POP(cid) \
  gtk_statusbar_pop(GTK_STATUSBAR(selfp->statusbar), (cid))
#define GET_ACTION(name) \
  gtk_action_group_get_action(selfp->action_group, (name))
#define FULLSCREEN \
  (selfp->leave_fullscreen_popup != NULL)

#line 50 "mn-main-window.c"
/* self casting macros */
#define SELF(x) MN_MAIN_WINDOW(x)
#define SELF_CONST(x) MN_MAIN_WINDOW_CONST(x)
#define IS_SELF(x) MN_IS_MAIN_WINDOW(x)
#define TYPE_SELF MN_TYPE_MAIN_WINDOW
#define SELF_CLASS(x) MN_MAIN_WINDOW_CLASS(x)

#define SELF_GET_CLASS(x) MN_MAIN_WINDOW_GET_CLASS(x)

/* self typedefs */
typedef MNMainWindow Self;
typedef MNMainWindowClass SelfClass;

/* here are local prototypes */
static void mn_main_window_class_init (MNMainWindowClass * c) G_GNUC_UNUSED;
static void mn_main_window_init (MNMainWindow * self) G_GNUC_UNUSED;
static void ___2_mn_main_window_dispose (GObject * object) G_GNUC_UNUSED;
static void mn_main_window_create_ui_manager (MNMainWindow * self) G_GNUC_UNUSED;
static void mn_main_window_create_toolbars_model (MNMainWindow * self, gboolean use_dot_file) G_GNUC_UNUSED;
static void mn_main_window_update_toolbars_visibility (MNMainWindow * self) G_GNUC_UNUSED;
static void mn_main_window_update_statusbar_visibility (MNMainWindow * self) G_GNUC_UNUSED;
static void mn_main_window_notify_mail_reader_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data) G_GNUC_UNUSED;
static void mn_main_window_update_messages (MNMainWindow * self) G_GNUC_UNUSED;
static void mn_main_window_update_sensitivity (MNMainWindow * self) G_GNUC_UNUSED;
static void mn_main_window_ui_manager_connect_proxy_h (MNMainWindow * self, GtkAction * action, GtkWidget * proxy, GtkUIManager * manager) G_GNUC_UNUSED;
static void mn_main_window_ui_manager_disconnect_proxy_h (MNMainWindow * self, GtkAction * action, GtkWidget * proxy, GtkUIManager * manager) G_GNUC_UNUSED;
static void mn_main_window_menu_item_select_h (MNMainWindow * self, GtkMenuItem * item) G_GNUC_UNUSED;
static void mn_main_window_menu_item_deselect_h (MNMainWindow * self, GtkMenuItem * item) G_GNUC_UNUSED;
static gboolean mn_main_window_window_state_event_h (MNMainWindow * self, GdkEventWindowState * event, gpointer user_data) G_GNUC_UNUSED;
static void mn_main_window_update_toolbars_style_changed_h (GtkRadioAction * action, GtkRadioAction * current, Self * self) G_GNUC_UNUSED;
static void mn_main_window_update_toolbars_style (MNMainWindow * self) G_GNUC_UNUSED;
static void mn_main_window_toolbars_model_save_changes (MNMainWindow * self) G_GNUC_UNUSED;
static gboolean mn_main_window_toolbars_model_save_changes_cb (MNMainWindow * self) G_GNUC_UNUSED;
static void mn_main_window_toolbars_model_update_flags_and_save_changes (MNMainWindow * self) G_GNUC_UNUSED;
static void mn_main_window_mail_reader_activate_h (GtkAction * action, Self * self) G_GNUC_UNUSED;
static void mn_main_window_update_activate_h (GtkAction * action, Self * self) G_GNUC_UNUSED;
static void mn_main_window_close_activate_h (GtkAction * action, Self * self) G_GNUC_UNUSED;
static void mn_main_window_quit_activate_h (GtkAction * action, Self * self) G_GNUC_UNUSED;
static void mn_main_window_edit_toolbars_activate_h (GtkAction * action, Self * self) G_GNUC_UNUSED;
static void mn_main_window_edit_toolbars_response_h (MNMainWindow * self, int response, GtkDialog * dialog) G_GNUC_UNUSED;
static void mn_main_window_edit_toolbars_create_editor (MNMainWindow * self) G_GNUC_UNUSED;
static void mn_main_window_edit_toolbars_weak_notify_cb (MNMainWindow * self, GObject * former_object) G_GNUC_UNUSED;
static void mn_main_window_preferences_activate_h (GtkAction * action, Self * self) G_GNUC_UNUSED;
static void mn_main_window_help_contents_activate_h (GtkAction * action, Self * self) G_GNUC_UNUSED;
static void mn_main_window_about_activate_h (GtkAction * action, Self * self) G_GNUC_UNUSED;
static void mn_main_window_fullscreen (MNMainWindow * self) G_GNUC_UNUSED;
static void mn_main_window_unfullscreen (MNMainWindow * self) G_GNUC_UNUSED;
static gboolean mn_main_window_leave_fullscreen_timeout_cb (MNMainWindow * self) G_GNUC_UNUSED;
static gboolean mn_main_window_leave_fullscreen_enter_notify_event_h (MNMainWindow * self, GdkEventCrossing * event, GtkWidget * widget) G_GNUC_UNUSED;
static gboolean mn_main_window_leave_fullscreen_leave_notify_event_h (MNMainWindow * self, GdkEventCrossing * event, GtkWidget * widget) G_GNUC_UNUSED;
static void mn_main_window_update_leave_fullscreen_popup_position (MNMainWindow * self) G_GNUC_UNUSED;
static gboolean mn_main_window_fullscreen_key_press_event_h (MNMainWindow * self, GdkEventKey * event, gpointer user_data) G_GNUC_UNUSED;
static void mn_main_window_fullscreen_menubar_deactivate_h (MNMainWindow * self, GtkMenuShell * menushell) G_GNUC_UNUSED;

/* pointer to the class of our parent */
static GtkWindowClass *parent_class = NULL;

/* Short form macros */
#define self_create_ui_manager mn_main_window_create_ui_manager
#define self_create_toolbars_model mn_main_window_create_toolbars_model
#define self_update_toolbars_visibility mn_main_window_update_toolbars_visibility
#define self_update_statusbar_visibility mn_main_window_update_statusbar_visibility
#define self_notify_mail_reader_cb mn_main_window_notify_mail_reader_cb
#define self_update_messages mn_main_window_update_messages
#define self_update_sensitivity mn_main_window_update_sensitivity
#define self_ui_manager_connect_proxy_h mn_main_window_ui_manager_connect_proxy_h
#define self_ui_manager_disconnect_proxy_h mn_main_window_ui_manager_disconnect_proxy_h
#define self_menu_item_select_h mn_main_window_menu_item_select_h
#define self_menu_item_deselect_h mn_main_window_menu_item_deselect_h
#define self_window_state_event_h mn_main_window_window_state_event_h
#define self_update_toolbars_style_changed_h mn_main_window_update_toolbars_style_changed_h
#define self_update_toolbars_style mn_main_window_update_toolbars_style
#define self_toolbars_model_save_changes mn_main_window_toolbars_model_save_changes
#define self_toolbars_model_save_changes_cb mn_main_window_toolbars_model_save_changes_cb
#define self_toolbars_model_update_flags_and_save_changes mn_main_window_toolbars_model_update_flags_and_save_changes
#define self_mail_reader_activate_h mn_main_window_mail_reader_activate_h
#define self_update_activate_h mn_main_window_update_activate_h
#define self_close_activate_h mn_main_window_close_activate_h
#define self_quit_activate_h mn_main_window_quit_activate_h
#define self_edit_toolbars_activate_h mn_main_window_edit_toolbars_activate_h
#define self_edit_toolbars_response_h mn_main_window_edit_toolbars_response_h
#define self_edit_toolbars_create_editor mn_main_window_edit_toolbars_create_editor
#define self_edit_toolbars_weak_notify_cb mn_main_window_edit_toolbars_weak_notify_cb
#define self_preferences_activate_h mn_main_window_preferences_activate_h
#define self_help_contents_activate_h mn_main_window_help_contents_activate_h
#define self_about_activate_h mn_main_window_about_activate_h
#define self_fullscreen mn_main_window_fullscreen
#define self_unfullscreen mn_main_window_unfullscreen
#define self_leave_fullscreen_timeout_cb mn_main_window_leave_fullscreen_timeout_cb
#define self_leave_fullscreen_enter_notify_event_h mn_main_window_leave_fullscreen_enter_notify_event_h
#define self_leave_fullscreen_leave_notify_event_h mn_main_window_leave_fullscreen_leave_notify_event_h
#define self_update_leave_fullscreen_popup_position mn_main_window_update_leave_fullscreen_popup_position
#define self_fullscreen_key_press_event_h mn_main_window_fullscreen_key_press_event_h
#define self_fullscreen_menubar_deactivate_h mn_main_window_fullscreen_menubar_deactivate_h
GType
mn_main_window_get_type (void)
{
	static GType type = 0;

	if ___GOB_UNLIKELY(type == 0) {
		static const GTypeInfo info = {
			sizeof (MNMainWindowClass),
			(GBaseInitFunc) NULL,
			(GBaseFinalizeFunc) NULL,
			(GClassInitFunc) mn_main_window_class_init,
			(GClassFinalizeFunc) NULL,
			NULL /* class_data */,
			sizeof (MNMainWindow),
			0 /* n_preallocs */,
			(GInstanceInitFunc) mn_main_window_init,
			NULL
		};

		type = g_type_register_static (GTK_TYPE_WINDOW, "MNMainWindow", &info, (GTypeFlags)0);
	}

	return type;
}

/* a macro for creating a new object of our type */
#define GET_NEW ((MNMainWindow *)g_object_new(mn_main_window_get_type(), NULL))

/* a function for creating a new object of our type */
#include <stdarg.h>
static MNMainWindow * GET_NEW_VARG (const char *first, ...) G_GNUC_UNUSED;
static MNMainWindow *
GET_NEW_VARG (const char *first, ...)
{
	MNMainWindow *ret;
	va_list ap;
	va_start (ap, first);
	ret = (MNMainWindow *)g_object_new_valist (mn_main_window_get_type (), first, ap);
	va_end (ap);
	return ret;
}


static void
___dispose (GObject *obj_self)
{
#define __GOB_FUNCTION__ "MN:Main:Window::dispose"
	MNMainWindow *self G_GNUC_UNUSED = MN_MAIN_WINDOW (obj_self);
#line 138 "mn-main-window.gob"
	___2_mn_main_window_dispose(obj_self);
#line 195 "mn-main-window.c"
#line 59 "mn-main-window.gob"
	if(self->_priv->ui_manager) { g_object_unref ((gpointer) self->_priv->ui_manager); self->_priv->ui_manager = NULL; }
#line 198 "mn-main-window.c"
#line 60 "mn-main-window.gob"
	if(self->_priv->action_group) { g_object_unref ((gpointer) self->_priv->action_group); self->_priv->action_group = NULL; }
#line 201 "mn-main-window.c"
#line 62 "mn-main-window.gob"
	if(self->_priv->toolbars_model) { g_object_unref ((gpointer) self->_priv->toolbars_model); self->_priv->toolbars_model = NULL; }
#line 204 "mn-main-window.c"
}
#undef __GOB_FUNCTION__


static void
___finalize(GObject *obj_self)
{
#define __GOB_FUNCTION__ "MN:Main:Window::finalize"
	MNMainWindow *self G_GNUC_UNUSED = MN_MAIN_WINDOW (obj_self);
	gpointer priv G_GNUC_UNUSED = self->_priv;
	if(G_OBJECT_CLASS(parent_class)->finalize) \
		(* G_OBJECT_CLASS(parent_class)->finalize)(obj_self);
}
#undef __GOB_FUNCTION__

static void 
mn_main_window_class_init (MNMainWindowClass * c G_GNUC_UNUSED)
{
#define __GOB_FUNCTION__ "MN:Main:Window::class_init"
	GObjectClass *g_object_class G_GNUC_UNUSED = (GObjectClass*) c;

	g_type_class_add_private(c,sizeof(MNMainWindowPrivate));

	parent_class = g_type_class_ref (GTK_TYPE_WINDOW);

#line 138 "mn-main-window.gob"
	g_object_class->dispose = ___dispose;
#line 232 "mn-main-window.c"
	g_object_class->finalize = ___finalize;
}
#undef __GOB_FUNCTION__
#line 75 "mn-main-window.gob"
static void 
mn_main_window_init (MNMainWindow * self G_GNUC_UNUSED)
#line 239 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::init"
	self->_priv = G_TYPE_INSTANCE_GET_PRIVATE(self,MN_TYPE_MAIN_WINDOW,MNMainWindowPrivate);
 {
#line 76 "mn-main-window.gob"

    GtkWidget *scrolled;
    GtkWidget *vbox;

    self_create_ui_manager(self);
    self_create_toolbars_model(self, TRUE);

    selfp->menubar = gtk_ui_manager_get_widget(selfp->ui_manager, "/menubar");
    selfp->toolbar = egg_editable_toolbar_new_with_model(selfp->ui_manager, selfp->toolbars_model);

    scrolled = gtk_scrolled_window_new(NULL, NULL);
    gtk_scrolled_window_set_policy(GTK_SCROLLED_WINDOW(scrolled),
				   GTK_POLICY_AUTOMATIC,
				   GTK_POLICY_AUTOMATIC);

    selfp->message_view = mn_message_view_new(FALSE, TRUE);
    gtk_widget_set_name(selfp->message_view, "mn-message-view");
    gtk_container_set_border_width(GTK_CONTAINER(selfp->message_view), 12);
    gtk_container_add(GTK_CONTAINER(scrolled), selfp->message_view);

    selfp->statusbar = gtk_statusbar_new();

    vbox = gtk_vbox_new(FALSE, 0);
    gtk_box_pack_start(GTK_BOX(vbox), selfp->menubar, FALSE, FALSE, 0);
    gtk_box_pack_start(GTK_BOX(vbox), selfp->toolbar, FALSE, FALSE, 0);
    gtk_box_pack_start(GTK_BOX(vbox), scrolled, TRUE, TRUE, 0);
    gtk_box_pack_start(GTK_BOX(vbox), selfp->statusbar, FALSE, FALSE, 0);
    gtk_widget_show_all(vbox);
    gtk_container_add(GTK_CONTAINER(self), vbox);

    selfp->help_cid = gtk_statusbar_get_context_id(GTK_STATUSBAR(selfp->statusbar), _("Help messages"));
    selfp->count_cid = gtk_statusbar_get_context_id(GTK_STATUSBAR(selfp->statusbar), _("Count messages"));

    mn_conf_link(self, MN_CONF_MAIN_WINDOW_DIMENSIONS,
		 GET_ACTION("ViewToolbars"), MN_CONF_MAIN_WINDOW_VIEW_TOOLBARS,
		 GET_ACTION("ViewStatusbar"), MN_CONF_MAIN_WINDOW_VIEW_STATUSBAR,
		 GET_ACTION("ViewToolbarsStyleDesktopDefault"), MN_CONF_MAIN_WINDOW_TOOLBARS_STYLE, MN_TYPE_TOOLBAR_STYLE,
		 NULL);

    self_update_toolbars_visibility(self);
    self_update_statusbar_visibility(self);

    g_signal_connect_swapped(GET_ACTION("ViewToolbars"), "toggled", G_CALLBACK(self_update_toolbars_visibility), self);
    g_signal_connect_swapped(GET_ACTION("ViewStatusbar"), "toggled", G_CALLBACK(self_update_statusbar_visibility), self);

    self_update_messages(self);
    self_update_sensitivity(self);

    mn_conf_notification_add(self,
			     MN_CONF_COMMANDS_MAIL_READER_NAMESPACE,
			     self_notify_mail_reader_cb,
			     self);
    mn_g_object_connect(self,
			mn_shell->mailboxes,
			"swapped-signal::notify::must-poll", self_update_sensitivity, self,
			"swapped-signal::messages-changed", self_update_messages, self,
			NULL);
    g_signal_connect(self, "window-state-event", G_CALLBACK(self_window_state_event_h), NULL);

    gtk_widget_grab_focus(selfp->message_view);
  
#line 306 "mn-main-window.c"
 }
}
#undef __GOB_FUNCTION__



#line 138 "mn-main-window.gob"
static void 
___2_mn_main_window_dispose (GObject * object G_GNUC_UNUSED)
#line 316 "mn-main-window.c"
#define PARENT_HANDLER(___object) \
	{ if(G_OBJECT_CLASS(parent_class)->dispose) \
		(* G_OBJECT_CLASS(parent_class)->dispose)(___object); }
{
#define __GOB_FUNCTION__ "MN:Main:Window::dispose"
{
#line 140 "mn-main-window.gob"
	
    Self *self = SELF(object);

    mn_source_clear(&selfp->toolbars_model_save_idle_id);

    if (FULLSCREEN)
      self_unfullscreen(self);

    PARENT_HANDLER(object);
  }}
#line 334 "mn-main-window.c"
#undef __GOB_FUNCTION__
#undef PARENT_HANDLER

#line 151 "mn-main-window.gob"
static void 
mn_main_window_create_ui_manager (MNMainWindow * self)
#line 341 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::create_ui_manager"
#line 151 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 151 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 348 "mn-main-window.c"
{
#line 153 "mn-main-window.gob"
	
    static GtkActionEntry menu_entries[] = {
      /* Toplevel */
      { "Mail", NULL, N_("_Mail") },
      { "Edit", NULL, N_("_Edit") },
      { "View", NULL, N_("_View") },
      { "Help", NULL, N_("_Help") },

      /* Mail menu */
      {
	"MailMailReader",
	MN_STOCK_MAIL_READER,
	N_("_Mail Reader"),
	"<control>M",
	N_("Launch the mail reader"),
	G_CALLBACK(self_mail_reader_activate_h)
      },
      {
	"MailUpdate",
	GTK_STOCK_REFRESH,
	N_("_Update"),
	"<control>R",		/* Reload */
	N_("Update the mail status"),
	G_CALLBACK(self_update_activate_h)
      },
      {
	"MailClose",
	GTK_STOCK_CLOSE,
	N_("_Close"),
	"<control>W",
	N_("Close this window"),
	G_CALLBACK(self_close_activate_h)
      },
      {
	"MailQuit",
	GTK_STOCK_QUIT,
	N_("_Quit"),
	"<control>Q",
	N_("Quit Mail Notification"),
	G_CALLBACK(self_quit_activate_h)
      },

      /* Edit menu */
      {
	"EditToolbars",
	NULL,
	N_("_Toolbars"),
	NULL,
	N_("Customize the toolbars"),
	G_CALLBACK(self_edit_toolbars_activate_h)
      },
      {
	"EditPreferences",
	GTK_STOCK_PREFERENCES,
	N_("_Preferences"),
	NULL,
	N_("Configure Mail Notification"),
	G_CALLBACK(self_preferences_activate_h)
      },

      /* View menu */
      {
	"ViewToolbarsStyle",
	NULL,
	N_("Toolbars Styl_e"),
	NULL,
	N_("Customize the toolbars style"),
	NULL
      },

      /* Help menu */
      {
	"HelpContents",
	GTK_STOCK_HELP,
	N_("_Contents"),
	"F1",
	N_("Display help"),
	G_CALLBACK(self_help_contents_activate_h)
      },
      {
	"HelpAbout",
	GTK_STOCK_ABOUT,
	N_("_About"),
	NULL,
	N_("Display credits"),
	G_CALLBACK(self_about_activate_h)
      }
    };

    static GtkToggleActionEntry toggle_entries[] = {
      /* View menu */
      {
	"ViewToolbars",
	NULL,
	N_("_Toolbars"),
	NULL,
	N_("Show or hide the toolbars"),
	NULL,
	FALSE
      },
      {
	"ViewStatusbar",
	NULL,
	N_("_Statusbar"),
	NULL,
	N_("Show or hide the statusbar"),
	NULL,
	FALSE
      }
    };

    static GtkRadioActionEntry toolbars_style_entries[] = {
      /* View menu */
      {
	"ViewToolbarsStyleDesktopDefault",
	NULL,
	N_("_Desktop Default"),
	NULL,
	N_("Set the toolbars style to the desktop default setting"),
	MN_TOOLBAR_STYLE_DESKTOP_DEFAULT
      },
      {
	"ViewToolbarsStyleIconsOnly",
	NULL,
	N_("I_cons Only"),
	NULL,
	N_("Only display the toolbars icons"),
	MN_TOOLBAR_STYLE_ICONS
      },
      {
	"ViewToolbarsStyleTextOnly",
	NULL,
	N_("_Text Only"),
	NULL,
	N_("Only display the toolbars text"),
	MN_TOOLBAR_STYLE_TEXT
      },
      {
	"ViewToolbarsStyleTextBelowIcons",
	NULL,
	N_("Text Belo_w Icons"),
	NULL,
	N_("Display the toolbars text below the icons"),
	MN_TOOLBAR_STYLE_BOTH
      },
      {
	"ViewToolbarsStyleTextBesideIcons",
	NULL,
	N_("Text Be_side Icons"),
	NULL,
	N_("Display the toolbars text beside the icons"),
	MN_TOOLBAR_STYLE_BOTH_HORIZ
      }
    };

    GError *err = NULL;
    GtkAccelGroup *accel_group;

    g_return_if_fail(selfp->ui_manager == NULL);

    selfp->ui_manager = gtk_ui_manager_new();

    g_object_connect(selfp->ui_manager,
		     "swapped-signal::connect-proxy", self_ui_manager_connect_proxy_h, self,
		     "swapped-signal::disconnect-proxy", self_ui_manager_disconnect_proxy_h, self,
		     NULL);

    selfp->action_group = gtk_action_group_new("MainWindowActions");
    gtk_action_group_set_translation_domain(selfp->action_group, NULL);
    
    gtk_action_group_add_actions(selfp->action_group,
				 menu_entries,
				 G_N_ELEMENTS(menu_entries),
				 self);
    gtk_action_group_add_toggle_actions(selfp->action_group,
					toggle_entries,
					G_N_ELEMENTS(toggle_entries),
					self);
    gtk_action_group_add_radio_actions(selfp->action_group,
				       toolbars_style_entries,
				       G_N_ELEMENTS(toolbars_style_entries),
				       -1,
				       G_CALLBACK(self_update_toolbars_style_changed_h),
				       self);
    gtk_ui_manager_insert_action_group(selfp->ui_manager, selfp->action_group, 0);

    g_object_set(G_OBJECT(GET_ACTION("MailMailReader")),
		 "is-important", TRUE,
		 NULL);

    if (! gtk_ui_manager_add_ui_from_file(selfp->ui_manager, MN_INTERFACE_FILE("menus.xml"), &err))
      {
	g_critical(_("unable to load menus.xml: %s"), err->message);
	g_error_free(err);
      }

    accel_group = gtk_ui_manager_get_accel_group(selfp->ui_manager);
    gtk_window_add_accel_group(GTK_WINDOW(self), accel_group);

    /*
     * ~/.gnome2/accels/mail-notification is automatically loaded by
     * the libgnomeui module, we just need to save it ourselves.
     */
    g_signal_connect(accel_group, "accel-changed", G_CALLBACK(gnome_accelerators_sync), NULL);
  }}
#line 556 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 359 "mn-main-window.gob"
static void 
mn_main_window_create_toolbars_model (MNMainWindow * self, gboolean use_dot_file)
#line 562 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::create_toolbars_model"
#line 359 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 359 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 569 "mn-main-window.c"
{
#line 361 "mn-main-window.gob"
	
    gboolean load_default_toolbars = TRUE;

    if (selfp->toolbars_model)
      g_object_unref(selfp->toolbars_model);

    selfp->toolbars_model = egg_toolbars_model_new();

    g_object_connect(selfp->toolbars_model,
		     "swapped-signal-after::item-added", self_toolbars_model_save_changes, self,
		     "swapped-signal-after::item-removed", self_toolbars_model_save_changes, self,
		     "swapped-signal-after::toolbar-added", self_toolbars_model_update_flags_and_save_changes, self,
		     "swapped-signal-after::toolbar-removed", self_toolbars_model_update_flags_and_save_changes, self,
		     NULL);

    if (use_dot_file)
      {
	char *filename;

	filename = g_build_filename(mn_conf_dot_dir, "toolbars.xml", NULL);
	load_default_toolbars = ! egg_toolbars_model_load(selfp->toolbars_model, filename);
	g_free(filename);
      }

    if (load_default_toolbars)
      {
	if (! egg_toolbars_model_load(selfp->toolbars_model, MN_INTERFACE_FILE("toolbars.xml")))
	  g_critical(_("unable to load toolbars.xml"));
      }
  
  if (egg_toolbars_model_n_toolbars(selfp->toolbars_model) < 1)
    egg_toolbars_model_add_toolbar(selfp->toolbars_model, 0, "DefaultToolbar");

  if (selfp->toolbar)
    egg_editable_toolbar_set_model(EGG_EDITABLE_TOOLBAR(selfp->toolbar), selfp->toolbars_model);
  }}
#line 608 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 398 "mn-main-window.gob"
static void 
mn_main_window_update_toolbars_visibility (MNMainWindow * self)
#line 614 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::update_toolbars_visibility"
#line 398 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 398 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 621 "mn-main-window.c"
{
#line 400 "mn-main-window.gob"
	
    g_object_set(G_OBJECT(selfp->toolbar), "visible", gtk_toggle_action_get_active(GTK_TOGGLE_ACTION(GET_ACTION("ViewToolbars"))), NULL);
  }}
#line 627 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 404 "mn-main-window.gob"
static void 
mn_main_window_update_statusbar_visibility (MNMainWindow * self)
#line 633 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::update_statusbar_visibility"
#line 404 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 404 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 640 "mn-main-window.c"
{
#line 406 "mn-main-window.gob"
	
    g_object_set(G_OBJECT(selfp->statusbar), "visible", ! FULLSCREEN && gtk_toggle_action_get_active(GTK_TOGGLE_ACTION(GET_ACTION("ViewStatusbar"))), NULL);
  }}
#line 646 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 410 "mn-main-window.gob"
static void 
mn_main_window_notify_mail_reader_cb (GConfClient * client, unsigned int cnxn_id, GConfEntry * entry, gpointer user_data)
#line 652 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::notify_mail_reader_cb"
{
#line 415 "mn-main-window.gob"
	
    Self *self = user_data;

    GDK_THREADS_ENTER();
    self_update_sensitivity(self);
    GDK_THREADS_LEAVE();
  }}
#line 664 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 423 "mn-main-window.gob"
static void 
mn_main_window_update_messages (MNMainWindow * self)
#line 670 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::update_messages"
#line 423 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 423 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 677 "mn-main-window.c"
{
#line 425 "mn-main-window.gob"
	
    GSList *messages;
    int count;

    messages = mn_mailboxes_get_messages(mn_shell->mailboxes);
    count = g_slist_length(messages);

    mn_message_view_set_messages(MN_MESSAGE_VIEW(selfp->message_view), messages);
    mn_g_object_slist_free(messages);

    if (count > 0)
      {
	char *status;
	
	status = g_strdup_printf(ngettext("%i new message", "%i new messages", count), count);
	STATUS_PUSH(selfp->count_cid, status);
	g_free(status);
      }
    else
      STATUS_POP(selfp->count_cid);
  }}
#line 701 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 447 "mn-main-window.gob"
static void 
mn_main_window_update_sensitivity (MNMainWindow * self)
#line 707 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::update_sensitivity"
#line 447 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 447 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 714 "mn-main-window.c"
{
#line 449 "mn-main-window.gob"
	
    gtk_action_set_sensitive(GET_ACTION("MailMailReader"), mn_conf_has_command(MN_CONF_COMMANDS_MAIL_READER_NAMESPACE));
    gtk_action_set_sensitive(GET_ACTION("MailUpdate"), mn_mailboxes_get_must_poll(mn_shell->mailboxes));
  }}
#line 721 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 454 "mn-main-window.gob"
static void 
mn_main_window_ui_manager_connect_proxy_h (MNMainWindow * self, GtkAction * action, GtkWidget * proxy, GtkUIManager * manager)
#line 727 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::ui_manager_connect_proxy_h"
#line 454 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 454 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 734 "mn-main-window.c"
{
#line 459 "mn-main-window.gob"
	
    if (GTK_IS_MENU_ITEM(proxy))
      g_object_connect(proxy,
		       "swapped-signal::select", self_menu_item_select_h, self,
		       "swapped-signal::deselect", self_menu_item_deselect_h, self,
		       NULL);
  }}
#line 744 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 467 "mn-main-window.gob"
static void 
mn_main_window_ui_manager_disconnect_proxy_h (MNMainWindow * self, GtkAction * action, GtkWidget * proxy, GtkUIManager * manager)
#line 750 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::ui_manager_disconnect_proxy_h"
#line 467 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 467 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 757 "mn-main-window.c"
{
#line 472 "mn-main-window.gob"
	
    if (GTK_IS_MENU_ITEM(proxy))
      g_object_disconnect(proxy,
			  "any-signal", self_menu_item_select_h, self,
			  "any-signal", self_menu_item_deselect_h, self,
			  NULL);
  }}
#line 767 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 480 "mn-main-window.gob"
static void 
mn_main_window_menu_item_select_h (MNMainWindow * self, GtkMenuItem * item)
#line 773 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::menu_item_select_h"
#line 480 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 480 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 780 "mn-main-window.c"
{
#line 482 "mn-main-window.gob"
	
    GtkAction *action;
    char *tooltip = NULL;

    action = g_object_get_data(G_OBJECT(item), "gtk-action");
    g_return_if_fail(action != NULL);
  
    g_object_get(G_OBJECT(action), "tooltip", &tooltip, NULL);
    if (tooltip)
      {
	STATUS_PUSH(selfp->help_cid, tooltip);
	g_free(tooltip);
      }
  }}
#line 797 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 497 "mn-main-window.gob"
static void 
mn_main_window_menu_item_deselect_h (MNMainWindow * self, GtkMenuItem * item)
#line 803 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::menu_item_deselect_h"
#line 497 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 497 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 810 "mn-main-window.c"
{
#line 499 "mn-main-window.gob"
	
    STATUS_POP(selfp->help_cid);
  }}
#line 816 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 503 "mn-main-window.gob"
static gboolean 
mn_main_window_window_state_event_h (MNMainWindow * self, GdkEventWindowState * event, gpointer user_data)
#line 822 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::window_state_event_h"
#line 503 "mn-main-window.gob"
	g_return_val_if_fail (self != NULL, (gboolean )0);
#line 503 "mn-main-window.gob"
	g_return_val_if_fail (MN_IS_MAIN_WINDOW (self), (gboolean )0);
#line 829 "mn-main-window.c"
{
#line 505 "mn-main-window.gob"
	
    if (event->changed_mask & GDK_WINDOW_STATE_FULLSCREEN)
      {
	if (event->new_window_state & GDK_WINDOW_STATE_FULLSCREEN)
	  self_fullscreen(self);
	else
	  self_unfullscreen(self);
      }
    
    return FALSE;		/* propagate event */
  }}
#line 843 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 517 "mn-main-window.gob"
static void 
mn_main_window_update_toolbars_style_changed_h (GtkRadioAction * action, GtkRadioAction * current, Self * self)
#line 849 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::update_toolbars_style_changed_h"
{
#line 521 "mn-main-window.gob"
	
    self_update_toolbars_style(self);
  }}
#line 857 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 525 "mn-main-window.gob"
static void 
mn_main_window_update_toolbars_style (MNMainWindow * self)
#line 863 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::update_toolbars_style"
#line 525 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 525 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 870 "mn-main-window.c"
{
#line 527 "mn-main-window.gob"
	
    MNToolbarStyle style;
    EggTbModelFlags flag;
    int n_toolbars;
    int i;

    style = gtk_radio_action_get_current_value(GTK_RADIO_ACTION(GET_ACTION("ViewToolbarsStyleDesktopDefault")));
    if (style == MN_TOOLBAR_STYLE_DESKTOP_DEFAULT)
      g_object_get(gtk_widget_get_settings(selfp->toolbar), "gtk-toolbar-style", &style, NULL);

    if (FULLSCREEN && style == MN_TOOLBAR_STYLE_BOTH)
      style = MN_TOOLBAR_STYLE_ICONS;

    switch (style)
      {
      case MN_TOOLBAR_STYLE_ICONS:	flag = EGG_TB_MODEL_ICONS; break;
      case MN_TOOLBAR_STYLE_TEXT:	flag = EGG_TB_MODEL_TEXT; break;
      case MN_TOOLBAR_STYLE_BOTH:	flag = EGG_TB_MODEL_BOTH; break;
      case MN_TOOLBAR_STYLE_BOTH_HORIZ:	flag = EGG_TB_MODEL_BOTH_HORIZ; break;
      default:				g_assert_not_reached();
      }
    
    n_toolbars = egg_toolbars_model_n_toolbars(selfp->toolbars_model);

    for (i = 0; i < n_toolbars; i++)
      {
	EggTbModelFlags flags;

	flags = egg_toolbars_model_get_flags(selfp->toolbars_model, i);
	flags &= ~ (EGG_TB_MODEL_ICONS
		    | EGG_TB_MODEL_TEXT
		    | EGG_TB_MODEL_BOTH
		    | EGG_TB_MODEL_BOTH_HORIZ);
	flags |= flag;
	egg_toolbars_model_set_flags(selfp->toolbars_model, i, flags);
      }
  }}
#line 910 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 565 "mn-main-window.gob"
static void 
mn_main_window_toolbars_model_save_changes (MNMainWindow * self)
#line 916 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::toolbars_model_save_changes"
#line 565 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 565 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 923 "mn-main-window.c"
{
#line 567 "mn-main-window.gob"
	
    if (! selfp->toolbars_model_save_idle_id)
      selfp->toolbars_model_save_idle_id = g_idle_add((GSourceFunc) self_toolbars_model_save_changes_cb, self);
  }}
#line 930 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 572 "mn-main-window.gob"
static gboolean 
mn_main_window_toolbars_model_save_changes_cb (MNMainWindow * self)
#line 936 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::toolbars_model_save_changes_cb"
#line 572 "mn-main-window.gob"
	g_return_val_if_fail (self != NULL, (gboolean )0);
#line 572 "mn-main-window.gob"
	g_return_val_if_fail (MN_IS_MAIN_WINDOW (self), (gboolean )0);
#line 943 "mn-main-window.c"
{
#line 574 "mn-main-window.gob"
	
    char *filename;

    GDK_THREADS_ENTER();

    filename = g_build_filename(mn_conf_dot_dir, "toolbars.xml", NULL);
    egg_toolbars_model_save(selfp->toolbars_model, filename, "1.0");
    g_free(filename);

    GDK_THREADS_LEAVE();

    selfp->toolbars_model_save_idle_id = 0;
    return FALSE;		/* remove */
  }}
#line 960 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 589 "mn-main-window.gob"
static void 
mn_main_window_toolbars_model_update_flags_and_save_changes (MNMainWindow * self)
#line 966 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::toolbars_model_update_flags_and_save_changes"
#line 589 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 589 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 973 "mn-main-window.c"
{
#line 591 "mn-main-window.gob"
	
    int i;
    int n_toolbars;
    EggTbModelFlags flag = EGG_TB_MODEL_ACCEPT_ITEMS_ONLY;

    n_toolbars = egg_toolbars_model_n_toolbars(selfp->toolbars_model);
  
    if (n_toolbars <= 1)
      flag |= EGG_TB_MODEL_NOT_REMOVABLE;

    for (i = 0; i < n_toolbars; i++)
      {
	EggTbModelFlags flags;
	
	flags = egg_toolbars_model_get_flags(selfp->toolbars_model, i);
	flags &= ~EGG_TB_MODEL_NOT_REMOVABLE;
	flags |= flag;
	egg_toolbars_model_set_flags(selfp->toolbars_model, i, flags);
      }

    self_toolbars_model_save_changes(self);
  }}
#line 998 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 614 "mn-main-window.gob"
static void 
mn_main_window_mail_reader_activate_h (GtkAction * action, Self * self)
#line 1004 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::mail_reader_activate_h"
{
#line 616 "mn-main-window.gob"
	
    mn_execute_command(MN_CONF_COMMANDS_MAIL_READER_COMMAND);
  }}
#line 1012 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 620 "mn-main-window.gob"
static void 
mn_main_window_update_activate_h (GtkAction * action, Self * self)
#line 1018 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::update_activate_h"
{
#line 622 "mn-main-window.gob"
	
    mn_mailboxes_check(mn_shell->mailboxes);
  }}
#line 1026 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 626 "mn-main-window.gob"
static void 
mn_main_window_close_activate_h (GtkAction * action, Self * self)
#line 1032 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::close_activate_h"
{
#line 628 "mn-main-window.gob"
	
    gtk_widget_destroy(GTK_WIDGET(self));
  }}
#line 1040 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 632 "mn-main-window.gob"
static void 
mn_main_window_quit_activate_h (GtkAction * action, Self * self)
#line 1046 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::quit_activate_h"
{
#line 634 "mn-main-window.gob"
	
    g_object_unref(mn_shell);
  }}
#line 1054 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 638 "mn-main-window.gob"
static void 
mn_main_window_edit_toolbars_activate_h (GtkAction * action, Self * self)
#line 1060 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::edit_toolbars_activate_h"
{
#line 640 "mn-main-window.gob"
	
    if (selfp->edit_toolbars_dialog)
      {
	gtk_window_present(GTK_WINDOW(selfp->edit_toolbars_dialog));
	return;
      }
  
    mn_create_interface(MN_INTERFACE_FILE("edit-toolbars-dialog.glade"),
			"dialog", &selfp->edit_toolbars_dialog,
			NULL);

    eel_add_weak_pointer(&selfp->edit_toolbars_dialog);
    g_object_weak_ref(G_OBJECT(selfp->edit_toolbars_dialog), (GWeakNotify) self_edit_toolbars_weak_notify_cb, self);
    
    gtk_window_set_transient_for(GTK_WINDOW(selfp->edit_toolbars_dialog), GTK_WINDOW(self));

    self_edit_toolbars_create_editor(self);
    egg_editable_toolbar_set_edit_mode(EGG_EDITABLE_TOOLBAR(selfp->toolbar), TRUE);

    mn_conf_link(selfp->edit_toolbars_dialog, MN_CONF_MAIN_WINDOW_EDIT_TOOLBARS_DIALOG, NULL);

    g_signal_connect_swapped(selfp->edit_toolbars_dialog, "response", G_CALLBACK(self_edit_toolbars_response_h), self);

    gtk_widget_show(selfp->edit_toolbars_dialog);
  }}
#line 1090 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 666 "mn-main-window.gob"
static void 
mn_main_window_edit_toolbars_response_h (MNMainWindow * self, int response, GtkDialog * dialog)
#line 1096 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::edit_toolbars_response_h"
#line 666 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 666 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 1103 "mn-main-window.c"
{
#line 668 "mn-main-window.gob"
	
    switch (response)
      {
      case GTK_RESPONSE_HELP:
	mn_display_help(GTK_WINDOW(dialog), "main-window-edit-toolbars");
	break;

      case 1:			/* use default */
	/* recreate the model, discarding the dot file */
	self_create_toolbars_model(self, FALSE);
	/* and recreate the editor, since the model has changed */
	self_edit_toolbars_create_editor(self);
	break;

      case 2:			/* add toolbar */
	egg_toolbars_model_add_toolbar(selfp->toolbars_model, -1, "UserCreated");
	break;
	
      case GTK_RESPONSE_CLOSE:
	gtk_widget_destroy(GTK_WIDGET(dialog));
	break;
      }
  }}
#line 1129 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 692 "mn-main-window.gob"
static void 
mn_main_window_edit_toolbars_create_editor (MNMainWindow * self)
#line 1135 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::edit_toolbars_create_editor"
#line 692 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 692 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 1142 "mn-main-window.c"
{
#line 694 "mn-main-window.gob"
	
    g_return_if_fail(selfp->edit_toolbars_dialog != NULL);

    if (selfp->edit_toolbars_editor)
      gtk_widget_destroy(selfp->edit_toolbars_editor);

    selfp->edit_toolbars_editor = egg_toolbar_editor_new(selfp->ui_manager, selfp->toolbars_model);
    eel_add_weak_pointer(&selfp->edit_toolbars_editor);

    gtk_container_set_border_width(GTK_CONTAINER(selfp->edit_toolbars_editor), 5);
    gtk_box_set_spacing(GTK_BOX(selfp->edit_toolbars_editor), 6);
  
    egg_toolbar_editor_load_actions(EGG_TOOLBAR_EDITOR(selfp->edit_toolbars_editor), MN_INTERFACE_FILE("toolbars.xml"));

    gtk_container_add(GTK_CONTAINER(GTK_DIALOG(selfp->edit_toolbars_dialog)->vbox), selfp->edit_toolbars_editor);
    gtk_widget_show(selfp->edit_toolbars_editor);
  }}
#line 1162 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 712 "mn-main-window.gob"
static void 
mn_main_window_edit_toolbars_weak_notify_cb (MNMainWindow * self, GObject * former_object)
#line 1168 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::edit_toolbars_weak_notify_cb"
#line 712 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 712 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 1175 "mn-main-window.c"
{
#line 714 "mn-main-window.gob"
	
    egg_editable_toolbar_set_edit_mode(EGG_EDITABLE_TOOLBAR(selfp->toolbar), FALSE);
  }}
#line 1181 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 718 "mn-main-window.gob"
static void 
mn_main_window_preferences_activate_h (GtkAction * action, Self * self)
#line 1187 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::preferences_activate_h"
{
#line 720 "mn-main-window.gob"
	
    mn_shell_display_properties_dialog(mn_shell, GTK_WINDOW(self));
  }}
#line 1195 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 724 "mn-main-window.gob"
static void 
mn_main_window_help_contents_activate_h (GtkAction * action, Self * self)
#line 1201 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::help_contents_activate_h"
{
#line 726 "mn-main-window.gob"
	
    mn_display_help(GTK_WINDOW(self), "main-window");
  }}
#line 1209 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 730 "mn-main-window.gob"
static void 
mn_main_window_about_activate_h (GtkAction * action, Self * self)
#line 1215 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::about_activate_h"
{
#line 732 "mn-main-window.gob"
	
    mn_shell_display_about_dialog(mn_shell, GTK_WINDOW(self));
  }}
#line 1223 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 736 "mn-main-window.gob"
static void 
mn_main_window_fullscreen (MNMainWindow * self)
#line 1229 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::fullscreen"
#line 736 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 736 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 1236 "mn-main-window.c"
{
#line 738 "mn-main-window.gob"
	
    GtkWidget *button;

    selfp->leave_fullscreen_popup = gtk_window_new(GTK_WINDOW_POPUP);
    eel_add_weak_pointer(&selfp->leave_fullscreen_popup);

    button = gtk_button_new_from_stock(MN_STOCK_LEAVE_FULLSCREEN);
    gtk_container_add(GTK_CONTAINER(selfp->leave_fullscreen_popup), button);
    gtk_widget_show(button);

    g_signal_connect_swapped(button, "clicked", G_CALLBACK(gtk_window_unfullscreen), self);

    gtk_widget_hide(selfp->menubar);
    self_update_toolbars_style(self);
    self_update_statusbar_visibility(self);

    selfp->leave_fullscreen_popup_visible = TRUE;
    self_update_leave_fullscreen_popup_position(self);
    gtk_widget_show(selfp->leave_fullscreen_popup);

    g_signal_connect_swapped(gdk_screen_get_default(),
			     "size-changed",
			     G_CALLBACK(self_update_leave_fullscreen_popup_position),
			     self);
    g_signal_connect(self,
		     "key-press-event",
		     G_CALLBACK(self_fullscreen_key_press_event_h),
		     NULL);

    g_object_connect(selfp->leave_fullscreen_popup,
		     "swapped-signal::enter-notify-event", self_leave_fullscreen_enter_notify_event_h, self,
		     "swapped-signal::leave-notify-event", self_leave_fullscreen_leave_notify_event_h, self,
		     NULL);

    selfp->leave_fullscreen_timeout_id = g_timeout_add(5000, (GSourceFunc) self_leave_fullscreen_timeout_cb, self);
  }}
#line 1275 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 775 "mn-main-window.gob"
static void 
mn_main_window_unfullscreen (MNMainWindow * self)
#line 1281 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::unfullscreen"
#line 775 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 775 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 1288 "mn-main-window.c"
{
#line 777 "mn-main-window.gob"
	
    g_signal_handlers_disconnect_by_func(gdk_screen_get_default(), self_update_leave_fullscreen_popup_position, self);

    mn_source_clear(&selfp->leave_fullscreen_timeout_id);
    gtk_widget_destroy(selfp->leave_fullscreen_popup);

    g_signal_handlers_disconnect_by_func(self, self_fullscreen_key_press_event_h, NULL);
      
    gtk_widget_show(selfp->menubar);
    self_update_toolbars_style(self);
    self_update_statusbar_visibility(self);
  }}
#line 1303 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 790 "mn-main-window.gob"
static gboolean 
mn_main_window_leave_fullscreen_timeout_cb (MNMainWindow * self)
#line 1309 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::leave_fullscreen_timeout_cb"
#line 790 "mn-main-window.gob"
	g_return_val_if_fail (self != NULL, (gboolean )0);
#line 790 "mn-main-window.gob"
	g_return_val_if_fail (MN_IS_MAIN_WINDOW (self), (gboolean )0);
#line 1316 "mn-main-window.c"
{
#line 792 "mn-main-window.gob"
	
    selfp->leave_fullscreen_popup_visible = FALSE;

    GDK_THREADS_ENTER();
    self_update_leave_fullscreen_popup_position(self);
    GDK_THREADS_LEAVE();
    
    selfp->leave_fullscreen_timeout_id = 0;
    return FALSE;		/* remove timeout */
  }}
#line 1329 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 803 "mn-main-window.gob"
static gboolean 
mn_main_window_leave_fullscreen_enter_notify_event_h (MNMainWindow * self, GdkEventCrossing * event, GtkWidget * widget)
#line 1335 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::leave_fullscreen_enter_notify_event_h"
#line 803 "mn-main-window.gob"
	g_return_val_if_fail (self != NULL, (gboolean )0);
#line 803 "mn-main-window.gob"
	g_return_val_if_fail (MN_IS_MAIN_WINDOW (self), (gboolean )0);
#line 1342 "mn-main-window.c"
{
#line 807 "mn-main-window.gob"
	
    mn_source_clear(&selfp->leave_fullscreen_timeout_id);
    selfp->leave_fullscreen_popup_visible = TRUE;
    self_update_leave_fullscreen_popup_position(self);

    return FALSE;		/* propagate event */
  }}
#line 1352 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 815 "mn-main-window.gob"
static gboolean 
mn_main_window_leave_fullscreen_leave_notify_event_h (MNMainWindow * self, GdkEventCrossing * event, GtkWidget * widget)
#line 1358 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::leave_fullscreen_leave_notify_event_h"
#line 815 "mn-main-window.gob"
	g_return_val_if_fail (self != NULL, (gboolean )0);
#line 815 "mn-main-window.gob"
	g_return_val_if_fail (MN_IS_MAIN_WINDOW (self), (gboolean )0);
#line 1365 "mn-main-window.c"
{
#line 819 "mn-main-window.gob"
	
    mn_source_clear(&selfp->leave_fullscreen_timeout_id);
    selfp->leave_fullscreen_timeout_id = g_timeout_add(5000, (GSourceFunc) self_leave_fullscreen_timeout_cb, self);

    return FALSE;		/* propagate event */
  }}
#line 1374 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 826 "mn-main-window.gob"
static void 
mn_main_window_update_leave_fullscreen_popup_position (MNMainWindow * self)
#line 1380 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::update_leave_fullscreen_popup_position"
#line 826 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 826 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 1387 "mn-main-window.c"
{
#line 828 "mn-main-window.gob"
	
    GdkScreen *screen;
    int monitor_num;
    GdkRectangle screen_rect;
    int popup_width;
    int popup_height;
    int y;

    g_return_if_fail(selfp->leave_fullscreen_popup != NULL);

    screen = gdk_screen_get_default();
    monitor_num = gdk_screen_get_monitor_at_window(screen, GTK_WIDGET(self)->window);
    gdk_screen_get_monitor_geometry(screen, monitor_num, &screen_rect);
    gtk_window_get_size(GTK_WINDOW(selfp->leave_fullscreen_popup), &popup_width, &popup_height);

    y = screen_rect.y;
    if (! selfp->leave_fullscreen_popup_visible)
      y -= popup_height - 2;

    gtk_window_move(GTK_WINDOW(selfp->leave_fullscreen_popup), screen_rect.width - popup_width, y);
  }}
#line 1411 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 850 "mn-main-window.gob"
static gboolean 
mn_main_window_fullscreen_key_press_event_h (MNMainWindow * self, GdkEventKey * event, gpointer user_data)
#line 1417 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::fullscreen_key_press_event_h"
#line 850 "mn-main-window.gob"
	g_return_val_if_fail (self != NULL, (gboolean )0);
#line 850 "mn-main-window.gob"
	g_return_val_if_fail (MN_IS_MAIN_WINDOW (self), (gboolean )0);
#line 1424 "mn-main-window.c"
{
#line 852 "mn-main-window.gob"
	
    unsigned int modifiers = gtk_accelerator_get_default_mod_mask();

    if (event->keyval == GDK_Escape && (event->state & modifiers) == 0)
      {
	gtk_window_unfullscreen(GTK_WINDOW(self));
	return TRUE;		/* do not propagate event */
      }
    else if (event->keyval == GDK_F10 && (event->state & modifiers) == 0)
      {
	g_signal_connect_swapped(selfp->menubar, "deactivate", G_CALLBACK(self_fullscreen_menubar_deactivate_h), self);

	gtk_widget_show(selfp->menubar);
	gtk_menu_shell_select_first(GTK_MENU_SHELL(selfp->menubar), FALSE);

	return TRUE;		/* do not propagate event */
      }
    else
      return FALSE;		/* propagate event */
  }}
#line 1447 "mn-main-window.c"
#undef __GOB_FUNCTION__

#line 873 "mn-main-window.gob"
static void 
mn_main_window_fullscreen_menubar_deactivate_h (MNMainWindow * self, GtkMenuShell * menushell)
#line 1453 "mn-main-window.c"
{
#define __GOB_FUNCTION__ "MN:Main:Window::fullscreen_menubar_deactivate_h"
#line 873 "mn-main-window.gob"
	g_return_if_fail (self != NULL);
#line 873 "mn-main-window.gob"
	g_return_if_fail (MN_IS_MAIN_WINDOW (self));
#line 1460 "mn-main-window.c"
{
#line 875 "mn-main-window.gob"
	
    g_signal_handlers_disconnect_by_func(selfp->menubar, G_CALLBACK(self_fullscreen_menubar_deactivate_h), self);
    gtk_menu_shell_deselect(menushell);
    gtk_widget_hide(selfp->menubar);
  }}
#line 1468 "mn-main-window.c"
#undef __GOB_FUNCTION__
